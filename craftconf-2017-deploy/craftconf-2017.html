<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Felix Klock (@pnkfelix), Mozilla">
  <title>Rust: Systems Programming for Everyone</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/mozilla-sandstone.css" id="theme">
  <link rel="stylesheet" href="slide-style.css"/>
  <link rel="stylesheet" href="code-style.css"/>
  <link rel="stylesheet" href="fonts.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
  <h1 class="title">Rust: Systems Programming for Everyone</h1>
  <p class="author">Felix Klock (<code>@pnkfelix</code>), Mozilla</p>
  <p class="date"><kbd class="key">space</kbd>: next slide; <kbd class="key">esc</kbd>: overview; arrows navigate <a href="http://pnkfx.org/presentations/craftconf-2017-deploy/craftconf-2017.html"><code>http://bit.ly/2qgUIle</code></a></p>
</section>

<section><section id="what-is-rust" class="titleslide slide level1 center"><h1>What is Rust?</h1></section><section id="what-is-rust-1" class="slide level2 center">
<h2>What is Rust?</h2>
<h3 id="new-programming-language">New programming language</h3>
<ul>
<li class="fragment">(... and ecosystem, and development community)</li>
</ul>
<h3 id="emphasizing-control-safety-and-speed">Emphasizing control, safety, and speed</h3>
<ul>
<li class="fragment">(... <em>especially</em> when it comes to concurrency)</li>
</ul>
<h3 id="low-level-hacking-without-fear-of-segfaults-nor-data-races">Low-level hacking without fear of segfaults nor data races</h3>
<ul>
<li class="fragment">or more simply: &quot;Hack without Fear&quot;</li>
</ul>
</section></section>
<section><section id="why-..." class="titleslide slide level1 center"><h1>Why ...?</h1></section><section id="why-use-rust" class="slide level2 big_text" data-transition="fade-out">
<h2>Why use Rust?</h2>
<ul>
<li class="fragment">Fast code, low memory footprint</li>
<li class="fragment">Go from bare metal (assembly; C FFI) ...
<div class="fragment">
... to high-level (closures, generic containers) ...
</div>
<div class="fragment">
with <em>zero cost</em> (no GC, unboxed closures, monomorphization); no runtime, cross-lang interop
</div></li>
<li class="fragment"><em>Safety</em> and <em>Parallelism</em></li>
</ul>
<aside class="notes">
<ul>
<li>So far, sounds like C++</li>
<li>&quot;but, the UB stops here&quot;</li>
</ul>
</aside>
</section><section id="section" class="slide level2 center">
<h2></h2>
<figure>
<img src="the_ub_stops_here.png" alt="Safety: No More Undefined Behavior" /><figcaption>Safety: No More Undefined Behavior</figcaption>
</figure>
<p>(apologies to Harry S. Truman)</p>
</section><section id="safety-and-parallelism" class="slide level2 center">
<h2>Safety and Parallelism</h2>
<h3 id="safety">Safety</h3>
<ul>
<li><p>No segmentation faults</p></li>
<li><p>No undefined behavior</p></li>
<li><p>No data races</p></li>
</ul>
<h3 id="multi-paradigm-parallelism">(Multi-paradigm) Parallelism</h3>
<ul>
<li><p>msg passing via channels</p></li>
<li><p>shared state (R/W-capabilities controlled via types)</p></li>
<li><p>use native threads... or scoped threads... or work-stealing...</p></li>
</ul>
</section></section>
<section><section id="lets-jump-in-safety" class="titleslide slide level1 center"><h1>Let's Jump In: Safety</h1></section><section id="section-1" class="slide level2">
<h2></h2>
<h5 id="c">C++</h5>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> gather_negs(<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; &amp;input, <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; &amp;out) {
    <span class="dt">int</span> count = <span class="dv">0</span>;
    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) { out.push_back(-val); count++; }
    }
    <span class="cf">return</span> count;
}</code></pre></div>
<h5 id="java">Java</h5>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">static</span> <span class="dt">int</span> <span class="fu">gather_negs</span>(<span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; input, <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; out) {
    <span class="dt">int</span> count = <span class="dv">0</span>;
    <span class="kw">for</span> (<span class="dt">int</span> val: input) {
        <span class="kw">if</span> (val &lt; <span class="dv">0</span>) { out.<span class="fu">add</span>(-val); count++; }
    }
    <span class="kw">return</span> count;
}</code></pre></div>
<h5 id="rust">Rust</h5>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> gather_negs(input: &amp;<span class="dt">Vec</span>&lt;<span class="dt">i32</span>&gt;, out: &amp;<span class="kw">mut</span> <span class="dt">Vec</span>&lt;<span class="dt">i32</span>&gt;) -&gt; <span class="dt">isize</span> <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> count = <span class="dv">0</span>;
    <span class="kw">for</span> val_ref <span class="kw">in</span> input <span class="op">{</span>
        <span class="kw">let</span> val = *val_ref;
        <span class="kw">if</span> val &lt; <span class="dv">0</span> <span class="op">{</span> out.push(-val); count += <span class="dv">1</span>; <span class="op">}</span>
    <span class="op">}</span>
    <span class="kw">return</span> count;
<span class="op">}</span></code></pre></div>
<div class="fragment">
<p>(silly? well ... slides are <del>strawmen</del> succinct)</p>
</div>
</section><section id="sample-usage-of-gather_negs" class="slide level2">
<h2>Sample usage of <code>gather_negs</code></h2>
<!--
```rust
fn test() {
```
-->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> values = <span class="op">[</span>-<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, -<span class="dv">4</span>, -<span class="dv">5</span>, -<span class="dv">6</span>, -<span class="dv">7</span>, -<span class="dv">8</span>, -<span class="dv">9</span>, <span class="dv">10</span><span class="op">]</span>;
<span class="kw">let</span> <span class="kw">mut</span> input = <span class="dt">Vec</span>::new();
input.extend_from_slice(&amp;values); <span class="co">// put `values` into `input` vector</span>
<span class="kw">let</span> <span class="kw">mut</span> myvector = <span class="dt">Vec</span>::new();
gather_negs(&amp;input, &amp;<span class="kw">mut</span> myvector); <span class="co">// gather neg vals of `input` into `myvector`</span></code></pre></div>
<!--
```rust
}
```
-->
<h4 id="can-make-similar-code-for-c-and-java-e.g." newmargin="0">can make similar code for C++ and Java, e.g.:</h4>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> values[] = { <span class="dv">-1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">-4</span>, <span class="dv">-5</span>, <span class="dv">-6</span>, <span class="dv">-7</span>, <span class="dv">-8</span>, <span class="dv">-9</span>, <span class="dv">10</span>};
<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; input(values, values + <span class="kw">sizeof</span>(values) / <span class="kw">sizeof</span>(<span class="dt">int</span>));
<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; myvector;
gather_negs(input, myvector); <span class="co">// gather neg vals of `input` into `myvector`</span></code></pre></div>
<svg version="1.1" baseProfile="full" width="550" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 550 112" height="112">
  <path fill="none" stroke-width="2" stroke="green" d="M 225,8L 240,8L 250,8L 260,8L 270,8L 280,8L 290,8L 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 545,8L 545,32L 545,40L 530,40L 520,40L 510,40L 500,40L 490,40L 480,40L 470,40L 460,40L 450,40L 440,40L 430,40L 420,40L 410,40L 400,40L 390,40L 380,40L 370,40L 360,40L 350,40L 340,40L 330,40L 320,40L 310,40L 300,40L 290,40L 280,40L 270,40L 260,40L 250,40L 240,40L 230,40L 225,40L 225,16 Z" />
  <path stroke-width="2" fill="none" d="M 225,72L 240,72L 250,72L 255,72L 255,96L 255,104L 240,104L 230,104L 225,104L 225,80 Z" stroke="green" />
  <path stroke="green" d="M 140,24 L 150,24L 160,24L 170,24L 180,24L 190,24L 200,24L 210,24L 215,24 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" />
  <path d="M 170,88 L 180,88L 190,88L 200,88L 210,88L 215,88 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" fill="none" stroke-width="2" />
  <text fill="black" xml:space="preserve" x="80" y="24" text-anchor="start" font-size="16" font-family="Menlo" dominant-baseline="middle">input </text>
  <text x="240" font-size="16" text-anchor="start" xml:space="preserve" font-family="Menlo" fill="black" dominant-baseline="middle" y="24">-1  2  3 -4 -5 -6 -7 -8 -9 10 </text>
  <text text-anchor="start" xml:space="preserve" fill="black" font-size="16" y="56" dominant-baseline="middle" font-family="Menlo" x="0">(BEFORE)</text>
  <text font-size="16" xml:space="preserve" fill="black" text-anchor="start" dominant-baseline="middle" y="88" x="80" font-family="Menlo">myvector </text>
</svg>
<div class="fragment">
<svg width="550" version="1.1" viewBox="0 0 550 112" height="112" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="green" d="M 225,8L 240,8L 250,8L 260,8L 270,8L 280,8L 290,8L 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 545,8L 545,32L 545,40L 530,40L 520,40L 510,40L 500,40L 490,40L 480,40L 470,40L 460,40L 450,40L 440,40L 430,40L 420,40L 410,40L 400,40L 390,40L 380,40L 370,40L 360,40L 350,40L 340,40L 330,40L 320,40L 310,40L 300,40L 290,40L 280,40L 270,40L 260,40L 250,40L 240,40L 230,40L 225,40L 225,16 Z" stroke-width="2" />
  <path stroke-width="2" d="M 225,72L 240,72L 250,72L 260,72L 270,72L 280,72L 290,72L 300,72L 310,72L 320,72L 330,72L 340,72L 350,72L 360,72L 370,72L 380,72L 390,72L 400,72L 410,72L 420,72L 430,72L 440,72L 450,72L 455,72L 455,96L 455,104L 440,104L 430,104L 420,104L 410,104L 400,104L 390,104L 380,104L 370,104L 360,104L 350,104L 340,104L 330,104L 320,104L 310,104L 300,104L 290,104L 280,104L 270,104L 260,104L 250,104L 240,104L 230,104L 225,104L 225,80 Z" fill="none" stroke="green" />
  <path fill="none" d="M 140,24 L 150,24L 160,24L 170,24L 180,24L 190,24L 200,24L 210,24L 215,24 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" stroke="green" />
  <path fill="none" d="M 170,88 L 180,88L 190,88L 200,88L 210,88L 215,88 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" stroke-width="2" />
  <text dominant-baseline="middle" font-size="16" fill="black" xml:space="preserve" font-family="Menlo" y="24" text-anchor="start" x="80">input </text>
  <text font-family="Menlo" dominant-baseline="middle" x="240" xml:space="preserve" font-size="16" text-anchor="start" fill="black" y="24">-1  2  3 -4 -5 -6 -7 -8 -9 10 </text>
  <text text-anchor="start" x="0" dominant-baseline="middle" xml:space="preserve" y="56" font-family="Menlo" font-size="16" fill="black">(AFTER)</text>
  <text font-size="16" fill="black" font-family="Menlo" xml:space="preserve" dominant-baseline="middle" text-anchor="start" x="80" y="88">myvector </text>
  <text text-anchor="start" y="88" font-size="16" dominant-baseline="middle" x="250" fill="black" xml:space="preserve" font-family="Menlo">1  4  5  6  7  8  9 </text>
</svg>
</div>
<div class="fragment">
<h5 id="same-for-rust-c-and-java.-so-why-is-rust-special">(Same for Rust, C++ and Java). So why is Rust special?</h5>
</div>
</section><section id="more-c-gather_negs" class="slide level2">
<h2>More C++ <code>gather_negs</code></h2>
<aside class="notes">
Strawman Example Alert!
</aside>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> values[] = { <span class="dv">-1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">-4</span>, <span class="dv">-5</span>, <span class="dv">-6</span>, <span class="dv">-7</span>, <span class="dv">-8</span>, <span class="dv">-9</span>, <span class="dv">10</span>};
<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; input(values, values + <span class="kw">sizeof</span>(values) / <span class="kw">sizeof</span>(<span class="dt">int</span>));
<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; myvector = input;

gather_negs(myvector, myvector); <span class="co">// gather neg vals of `myvector` into `myvector`</span></code></pre></div>
<p>How does <em>this</em> behave?</p>
<div class="fragment">
<p>Might expect:</p>
<svg viewBox="0 0 670 112" xmlns="http://www.w3.org/2000/svg" width="670" version="1.1" baseProfile="full" height="112">
  <path d="M 225,8L 240,8L 250,8L 260,8L 270,8L 280,8L 290,8L 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 525,8L 525,32L 525,40L 510,40L 500,40L 490,40L 480,40L 470,40L 460,40L 450,40L 440,40L 430,40L 420,40L 410,40L 400,40L 390,40L 380,40L 370,40L 360,40L 350,40L 340,40L 330,40L 320,40L 310,40L 300,40L 290,40L 280,40L 270,40L 260,40L 250,40L 240,40L 230,40L 225,40L 225,16 Z" stroke-width="2" stroke="green" fill="none" />
  <path fill="none" d="M 225,72L 240,72L 250,72L 260,72L 270,72L 280,72L 290,72L 300,72L 310,72L 320,72L 330,72L 340,72L 350,72L 360,72L 370,72L 380,72L 390,72L 400,72L 410,72L 420,72L 430,72L 440,72L 450,72L 460,72L 470,72L 480,72L 490,72L 500,72L 510,72L 520,72L 530,72L 540,72L 550,72L 560,72L 570,72L 580,72L 590,72L 600,72L 610,72L 620,72L 630,72L 640,72L 650,72L 660,72L 665,72L 665,96L 665,104L 650,104L 640,104L 630,104L 620,104L 610,104L 600,104L 590,104L 580,104L 570,104L 560,104L 550,104L 540,104L 530,104L 520,104L 510,104L 500,104L 490,104L 480,104L 470,104L 460,104L 450,104L 440,104L 430,104L 420,104L 410,104L 400,104L 390,104L 380,104L 370,104L 360,104L 350,104L 340,104L 330,104L 320,104L 310,104L 300,104L 290,104L 280,104L 270,104L 260,104L 250,104L 240,104L 230,104L 225,104L 225,80 Z" stroke="green" stroke-width="2" />
  <text x="0" xml:space="preserve" font-size="16" dominant-baseline="middle" font-family="Menlo" y="24" text-anchor="start" fill="black">(BEFORE)              </text>
  <text y="24" font-size="16" dominant-baseline="middle" font-family="Menlo" x="240" fill="black" text-anchor="start" xml:space="preserve">-1 2 3 -4 -5 -6 -7 -8 -9 10 </text>
  <text fill="black" dominant-baseline="middle" y="88" font-family="Menlo" text-anchor="start" x="0" font-size="16" xml:space="preserve">(AFTER)               </text>
  <text font-size="16" text-anchor="start" xml:space="preserve" font-family="Menlo" dominant-baseline="middle" x="240" y="88" fill="black">-1 2 3 -4 -5 -6 -7 -8 -9 10 1 4 5 6 7 8 9 </text>
</svg>
</div>
<div class="fragment">
<h5 id="reality-for-c-is">Reality (for C++) is:</h5>
<svg baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="730" version="1.1" viewBox="0 0 730 64" height="64">
  <path stroke="green" fill="none" stroke-width="2" d="M 5,24L 20,24L 30,24L 40,24L 50,24L 60,24L 70,24L 80,24L 90,24L 100,24L 110,24L 120,24L 130,24L 140,24L 150,24L 160,24L 170,24L 180,24L 190,24L 200,24L 210,24L 220,24L 230,24L 240,24L 250,24L 260,24L 270,24L 280,24L 290,24L 300,24L 310,24L 320,24L 330,24L 340,24L 350,24L 360,24L 370,24L 380,24L 390,24L 400,24L 410,24L 420,24L 430,24L 440,24L 450,24L 460,24L 470,24L 480,24L 490,24L 500,24L 510,24L 520,24L 530,24L 540,24L 550,24L 560,24L 570,24L 580,24L 590,24L 600,24L 610,24L 620,24L 630,24L 640,24L 650,24L 660,24L 670,24L 680,24L 690,24L 700,24L 710,24L 720,24L 725,24L 725,48L 725,56L 710,56L 700,56L 690,56L 680,56L 670,56L 660,56L 650,56L 640,56L 630,56L 620,56L 610,56L 600,56L 590,56L 580,56L 570,56L 560,56L 550,56L 540,56L 530,56L 520,56L 510,56L 500,56L 490,56L 480,56L 470,56L 460,56L 450,56L 440,56L 430,56L 420,56L 410,56L 400,56L 390,56L 380,56L 370,56L 360,56L 350,56L 340,56L 330,56L 320,56L 310,56L 300,56L 290,56L 280,56L 270,56L 260,56L 250,56L 240,56L 230,56L 220,56L 210,56L 200,56L 190,56L 180,56L 170,56L 160,56L 150,56L 140,56L 130,56L 120,56L 110,56L 100,56L 90,56L 80,56L 70,56L 60,56L 50,56L 40,56L 30,56L 20,56L 10,56L 5,56L 5,32 Z" />
  <text text-anchor="start" dominant-baseline="middle" x="20" y="40" font-size="16" xml:space="preserve" font-family="Menlo" fill="black">-1 2 3 -4 -5 -6 -7 -8 -9 10 1 4 5 6 7 8 9 1 4 5 6 7 8 9 1 4 5 6 7 8 9 </text>
</svg>
<h5 id="or">or:</h5>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full" width="930" viewBox="0 0 930 48" height="48">
  <path fill="none" d="M 5,8L 20,8L 30,8L 40,8L 50,8L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8L 190,8L 200,8L 210,8L 220,8L 230,8L 240,8L 250,8L 260,8L 270,8L 280,8L 290,8L 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8L 740,8L 750,8L 760,8L 770,8L 780,8L 790,8L 800,8L 810,8L 820,8L 830,8L 840,8L 850,8L 860,8L 870,8L 880,8L 890,8L 900,8L 910,8L 920,8L 925,8L 925,32L 925,40L 910,40L 900,40L 890,40L 880,40L 870,40L 860,40L 850,40L 840,40L 830,40L 820,40L 810,40L 800,40L 790,40L 780,40L 770,40L 760,40L 750,40L 740,40L 730,40L 720,40L 710,40L 700,40L 690,40L 680,40L 670,40L 660,40L 650,40L 640,40L 630,40L 620,40L 610,40L 600,40L 590,40L 580,40L 570,40L 560,40L 550,40L 540,40L 530,40L 520,40L 510,40L 500,40L 490,40L 480,40L 470,40L 460,40L 450,40L 440,40L 430,40L 420,40L 410,40L 400,40L 390,40L 380,40L 370,40L 360,40L 350,40L 340,40L 330,40L 320,40L 310,40L 300,40L 290,40L 280,40L 270,40L 260,40L 250,40L 240,40L 230,40L 220,40L 210,40L 200,40L 190,40L 180,40L 170,40L 160,40L 150,40L 140,40L 130,40L 120,40L 110,40L 100,40L 90,40L 80,40L 70,40L 60,40L 50,40L 40,40L 30,40L 20,40L 10,40L 5,40L 5,16 Z" stroke="green" stroke-width="2" />
  <text x="20" y="24" xml:space="preserve" font-family="Menlo" dominant-baseline="middle" font-size="16" text-anchor="start" fill="black">-1 2 3 -4 -5 -6 -7 -8 -9 10 1 4 5 6 7 8 9 1 4 5 6 7 8 9 536870912 536870912 1 4 5 6 7 8 9 </text>
</svg>
<h5 id="or-1">or:</h5>
<pre><code>Segmentation fault: 11</code></pre>
</div>
</section></section>
<section><section id="c-and-undefined-behavior" class="titleslide slide level1 center"><h1>C++ and Undefined Behavior</h1></section><section id="c-bugs-yield-undefined-behavior" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">&gt;   <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" height="208" width="780" viewBox="0 0 780 208">
  <path stroke-width="2" stroke="green" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" fill="none" />
  <path stroke="green" fill="none" stroke-width="2" d="M 285,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 285,16Q 285,8 290,8Q 290,8 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" />
  <path stroke="green" stroke-width="2" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" />
  <path stroke-width="2" stroke="green" fill="none" d="M 575,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 575,128L 575,144L 575,160L 575,176L 575,192Q 575,200 570,200Q 570,200 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text y="8" text-anchor="start" dominant-baseline="middle" x="80" font-size="16" fill="black" xml:space="preserve" font-family="Menlo">val                 </text>
  <text xml:space="preserve" font-family="Menlo" fill="black" dominant-baseline="middle" text-anchor="start" x="740" font-size="16" y="8">iter</text>
  <text font-size="16" font-family="Menlo" y="56" xml:space="preserve" dominant-baseline="middle" x="80" fill="black" text-anchor="start">myvector         </text>
  <text y="72" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" x="120" text-anchor="start" font-size="16" fill="black">buf </text>
  <text xml:space="preserve" y="72" dominant-baseline="middle" font-family="Menlo" text-anchor="start" x="270" font-size="16" fill="black">-1  2  3 -4 -5 -6 -7 -8 -9 10    </text>
  <text x="120" text-anchor="start" fill="black" font-family="Menlo" dominant-baseline="middle" font-size="16" y="88" xml:space="preserve">len = 10     </text>
  <text font-family="Menlo" x="120" dominant-baseline="middle" text-anchor="start" font-size="16" xml:space="preserve" y="104" fill="black">cap = 11                                     </text>
  <text font-size="16" y="200" xml:space="preserve" text-anchor="start" font-family="Menlo" dominant-baseline="middle" fill="black" x="80">myvector.end() </text>
</svg>
<aside class="notes">
Spelling out underlying vector representation here: three words, a pointer to the data buffer, its current length, and the buffered capacity, . Note I have chosen capacity here to accommodate my slides, rather than adhere to any one actual implementation.
</aside>
</section><section id="c-bugs-yield-undefined-behavior-1" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
&gt;       <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg width="780" height="208" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 208">
  <path d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="green" stroke-width="2" fill="none" />
  <path d="M 285,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 285,16Q 285,8 290,8Q 290,8 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke="green" stroke-width="2" fill="none" />
  <path stroke="green" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" />
  <path stroke-width="2" d="M 575,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 575,128L 575,144L 575,160L 575,176L 575,192Q 575,200 570,200Q 570,200 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" fill="none" stroke="green" />
  <text xml:space="preserve" font-size="16" text-anchor="start" y="8" x="80" font-family="Menlo" fill="black" dominant-baseline="middle">val = -1            </text>
  <text font-family="Menlo" x="740" y="8" text-anchor="start" fill="black" xml:space="preserve" font-size="16" dominant-baseline="middle">iter</text>
  <text font-size="16" xml:space="preserve" x="80" fill="black" y="56" font-family="Menlo" dominant-baseline="middle" text-anchor="start">myvector         </text>
  <text xml:space="preserve" x="120" font-family="Menlo" fill="black" y="72" text-anchor="start" dominant-baseline="middle" font-size="16">buf </text>
  <text x="270" dominant-baseline="middle" y="72" text-anchor="start" fill="black" font-size="16" xml:space="preserve" font-family="Menlo">-1  2  3 -4 -5 -6 -7 -8 -9 10    </text>
  <text font-family="Menlo" dominant-baseline="middle" fill="black" x="120" text-anchor="start" y="88" xml:space="preserve" font-size="16">len = 10     </text>
  <text y="104" fill="black" font-size="16" xml:space="preserve" x="120" text-anchor="start" dominant-baseline="middle" font-family="Menlo">cap = 11                                     </text>
  <text fill="black" font-size="16" x="80" font-family="Menlo" dominant-baseline="middle" xml:space="preserve" y="200" text-anchor="start">myvector.end() </text>
</svg>
<aside class="notes">
<p>First we load the <code>val</code> from the iterator</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-2" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
&gt;       <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg height="208" viewBox="0 0 780 208" baseProfile="full" xmlns="http://www.w3.org/2000/svg" version="1.1" width="780">
  <path d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="green" fill="none" stroke-width="2" />
  <path stroke-width="2" fill="none" d="M 285,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 285,16Q 285,8 290,8Q 290,8 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke="green" />
  <path stroke-width="2" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" stroke="green" />
  <path stroke="green" stroke-width="2" fill="none" d="M 575,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 575,128L 575,144L 575,160L 575,176L 575,192Q 575,200 570,200Q 570,200 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text font-size="16" text-anchor="start" font-family="Menlo" fill="black" y="8" x="80" xml:space="preserve" dominant-baseline="middle">val = -1            </text>
  <text font-family="Menlo" font-size="16" fill="black" dominant-baseline="middle" x="740" xml:space="preserve" text-anchor="start" y="8">iter</text>
  <text xml:space="preserve" y="56" font-family="Menlo" font-size="16" fill="black" dominant-baseline="middle" x="80" text-anchor="start">myvector         </text>
  <text dominant-baseline="middle" font-family="Menlo" fill="black" x="120" text-anchor="start" xml:space="preserve" font-size="16" y="72">buf </text>
  <text font-family="Menlo" dominant-baseline="middle" fill="black" y="72" x="270" text-anchor="start" xml:space="preserve" font-size="16">-1  2  3 -4 -5 -6 -7 -8 -9 10    </text>
  <text font-size="16" dominant-baseline="middle" xml:space="preserve" fill="black" font-family="Menlo" x="120" text-anchor="start" y="88">len = 10     </text>
  <text y="104" font-size="16" font-family="Menlo" xml:space="preserve" fill="black" text-anchor="start" dominant-baseline="middle" x="120">cap = 11                                     </text>
  <text text-anchor="start" x="80" xml:space="preserve" font-size="16" y="200" fill="black" font-family="Menlo" dominant-baseline="middle">myvector.end() </text>
</svg>
<aside class="notes">
<p>We check if its negative</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-3" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
&gt;           out.push_back(-val);
        }
    }</code></pre></div>
<svg width="780" baseProfile="full" version="1.1" viewBox="0 0 780 208" xmlns="http://www.w3.org/2000/svg" height="208">
  <path stroke-width="2" fill="none" stroke="green" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" />
  <path stroke-width="2" fill="none" stroke="green" d="M 285,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 285,16Q 285,8 290,8Q 290,8 300,8L 310,8L 320,8L 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" />
  <path stroke-width="2" fill="none" stroke="green" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path stroke-width="2" stroke="green" fill="none" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text font-family="Menlo" dominant-baseline="middle" y="8" text-anchor="start" font-size="16" xml:space="preserve" x="80" fill="black">val = -1            </text>
  <text font-size="16" fill="black" x="740" text-anchor="start" y="8" dominant-baseline="middle" font-family="Menlo" xml:space="preserve">iter</text>
  <text y="56" dominant-baseline="middle" font-size="16" x="80" xml:space="preserve" text-anchor="start" fill="black" font-family="Menlo">myvector         </text>
  <text x="120" font-size="16" dominant-baseline="middle" font-family="Menlo" text-anchor="start" fill="black" y="72" xml:space="preserve">buf </text>
  <text text-anchor="start" dominant-baseline="middle" font-size="16" fill="black" font-family="Menlo" x="270" xml:space="preserve" y="72">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text y="88" dominant-baseline="middle" text-anchor="start" fill="black" xml:space="preserve" font-size="16" x="120" font-family="Menlo">len = 11     </text>
  <text xml:space="preserve" x="120" font-family="Menlo" font-size="16" fill="black" y="104" text-anchor="start" dominant-baseline="middle">cap = 11                                         </text>
  <text text-anchor="start" dominant-baseline="middle" fill="black" xml:space="preserve" y="200" font-size="16" x="80" font-family="Menlo">myvector.end() </text>
</svg>
<aside class="notes">
<p>It is negative, so we negate it and push the result (1) on the end.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-4" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">&gt;   <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg viewBox="0 0 780 208" width="780" baseProfile="full" xmlns="http://www.w3.org/2000/svg" height="208" version="1.1">
  <path d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" fill="none" stroke-width="2" stroke="green" />
  <path fill="none" stroke="green" stroke-width="2" d="M 315,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 315,16Q 315,8 320,8Q 320,8 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" />
  <path stroke="green" fill="none" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" />
  <path stroke-width="2" stroke="green" fill="none" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text text-anchor="start" dominant-baseline="middle" x="80" y="8" fill="black" xml:space="preserve" font-family="Menlo" font-size="16">val                    </text>
  <text dominant-baseline="middle" text-anchor="start" x="740" font-size="16" y="8" xml:space="preserve" font-family="Menlo" fill="black">iter</text>
  <text dominant-baseline="middle" fill="black" y="56" text-anchor="start" font-family="Menlo" font-size="16" xml:space="preserve" x="80">myvector         </text>
  <text fill="black" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" font-size="16" x="120" y="72" text-anchor="start">buf </text>
  <text fill="black" text-anchor="start" font-size="16" xml:space="preserve" x="270" dominant-baseline="middle" y="72" font-family="Menlo">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text dominant-baseline="middle" font-size="16" text-anchor="start" xml:space="preserve" font-family="Menlo" fill="black" y="88" x="120">len = 11     </text>
  <text text-anchor="start" y="104" dominant-baseline="middle" font-size="16" x="120" font-family="Menlo" fill="black" xml:space="preserve">cap = 11                                         </text>
  <text x="80" fill="black" font-family="Menlo" xml:space="preserve" font-size="16" text-anchor="start" dominant-baseline="middle" y="200">myvector.end() </text>
</svg>
<aside class="notes">
<p>And we loop. Is the iteration done? No we haven't hit the end.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-5" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
&gt;       <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 208" version="1.1" height="208" width="780" baseProfile="full">
  <path stroke-width="2" fill="none" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="green" />
  <path fill="none" stroke="green" d="M 315,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 315,16Q 315,8 320,8Q 320,8 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke-width="2" />
  <path fill="none" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" stroke-width="2" />
  <path stroke-width="2" stroke="green" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" fill="none" />
  <text font-family="Menlo" fill="black" text-anchor="start" font-size="16" dominant-baseline="middle" y="8" x="80" xml:space="preserve">val = 2                </text>
  <text fill="black" xml:space="preserve" font-family="Menlo" x="740" text-anchor="start" y="8" font-size="16" dominant-baseline="middle">iter</text>
  <text xml:space="preserve" x="80" dominant-baseline="middle" y="56" fill="black" font-family="Menlo" text-anchor="start" font-size="16">myvector         </text>
  <text font-family="Menlo" fill="black" y="72" dominant-baseline="middle" xml:space="preserve" x="120" font-size="16" text-anchor="start">buf </text>
  <text y="72" font-family="Menlo" fill="black" xml:space="preserve" font-size="16" x="270" dominant-baseline="middle" text-anchor="start">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text text-anchor="start" font-size="16" font-family="Menlo" dominant-baseline="middle" y="88" fill="black" xml:space="preserve" x="120">len = 11     </text>
  <text y="104" x="120" xml:space="preserve" font-size="16" font-family="Menlo" dominant-baseline="middle" fill="black" text-anchor="start">cap = 11                                         </text>
  <text dominant-baseline="middle" y="200" text-anchor="start" xml:space="preserve" font-size="16" font-family="Menlo" x="80" fill="black">myvector.end() </text>
</svg>
<aside class="notes">
<p>So again we load the value.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-6" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
&gt;       <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg version="1.1" viewBox="0 0 780 208" height="208" xmlns="http://www.w3.org/2000/svg" width="780" baseProfile="full">
  <path stroke-width="2" stroke="green" fill="none" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" />
  <path stroke="green" fill="none" d="M 315,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 315,16Q 315,8 320,8Q 320,8 330,8L 340,8L 350,8L 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke-width="2" />
  <path stroke="green" stroke-width="2" fill="none" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path stroke-width="2" fill="none" stroke="green" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text font-size="16" text-anchor="start" xml:space="preserve" fill="black" dominant-baseline="middle" x="80" y="8" font-family="Menlo">val = 2                </text>
  <text dominant-baseline="middle" y="8" text-anchor="start" x="740" font-family="Menlo" xml:space="preserve" font-size="16" fill="black">iter</text>
  <text y="56" font-size="16" dominant-baseline="middle" x="80" fill="black" text-anchor="start" xml:space="preserve" font-family="Menlo">myvector         </text>
  <text text-anchor="start" x="120" fill="black" font-family="Menlo" xml:space="preserve" y="72" dominant-baseline="middle" font-size="16">buf </text>
  <text fill="black" x="270" y="72" dominant-baseline="middle" font-family="Menlo" text-anchor="start" xml:space="preserve" font-size="16">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text x="120" text-anchor="start" fill="black" y="88" font-family="Menlo" dominant-baseline="middle" font-size="16" xml:space="preserve">len = 11     </text>
  <text font-size="16" xml:space="preserve" y="104" fill="black" font-family="Menlo" dominant-baseline="middle" x="120" text-anchor="start">cap = 11                                         </text>
  <text text-anchor="start" font-family="Menlo" font-size="16" x="80" fill="black" y="200" dominant-baseline="middle" xml:space="preserve">myvector.end() </text>
</svg>
<aside class="notes">
<p>2 is non-negative, so we do nothing with it.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-7" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">&gt;   <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
&gt;       <span class="kw">auto</span> val = *it;
&gt;       <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg height="208" viewBox="0 0 780 208" xmlns="http://www.w3.org/2000/svg" width="780" baseProfile="full" version="1.1">
  <path fill="none" stroke="green" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke-width="2" />
  <path stroke-width="2" stroke="green" fill="none" d="M 345,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 345,16Q 345,8 350,8Q 350,8 360,8L 370,8L 380,8L 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" />
  <path d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" stroke="green" fill="none" />
  <path fill="none" stroke="green" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" stroke-width="2" />
  <text dominant-baseline="middle" x="80" fill="black" text-anchor="start" y="8" font-size="16" xml:space="preserve" font-family="Menlo">val = 3                   </text>
  <text x="740" font-size="16" dominant-baseline="middle" fill="black" text-anchor="start" y="8" xml:space="preserve" font-family="Menlo">iter</text>
  <text y="56" dominant-baseline="middle" xml:space="preserve" x="80" fill="black" font-size="16" text-anchor="start" font-family="Menlo">myvector         </text>
  <text xml:space="preserve" font-size="16" text-anchor="start" dominant-baseline="middle" y="72" fill="black" x="120" font-family="Menlo">buf </text>
  <text dominant-baseline="middle" xml:space="preserve" text-anchor="start" font-family="Menlo" x="270" font-size="16" fill="black" y="72">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text fill="black" text-anchor="start" font-family="Menlo" font-size="16" dominant-baseline="middle" xml:space="preserve" x="120" y="88">len = 11     </text>
  <text fill="black" text-anchor="start" x="120" font-size="16" xml:space="preserve" y="104" font-family="Menlo" dominant-baseline="middle">cap = 11                                         </text>
  <text xml:space="preserve" dominant-baseline="middle" y="200" fill="black" x="80" font-size="16" font-family="Menlo" text-anchor="start">myvector.end() </text>
</svg>
<aside class="notes">
<p>The case for 3rd elem is just like 2nd, so we'll zoom through it.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-8" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">&gt;   <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg width="780" baseProfile="full" version="1.1" viewBox="0 0 780 208" height="208" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke-width="2" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="green" />
  <path stroke="green" d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" fill="none" stroke-width="2" />
  <path d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" stroke-width="2" fill="none" />
  <path fill="none" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" stroke="green" stroke-width="2" />
  <text dominant-baseline="middle" x="740" text-anchor="start" y="8" xml:space="preserve" font-size="16" font-family="Menlo" fill="black">iter</text>
  <text xml:space="preserve" dominant-baseline="middle" text-anchor="start" y="56" x="80" font-family="Menlo" fill="black" font-size="16">myvector         </text>
  <text dominant-baseline="middle" xml:space="preserve" y="72" font-size="16" text-anchor="start" font-family="Menlo" x="120" fill="black">buf </text>
  <text font-size="16" font-family="Menlo" x="270" y="72" xml:space="preserve" dominant-baseline="middle" text-anchor="start" fill="black">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text y="88" x="120" fill="black" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" font-size="16" text-anchor="start">len = 11     </text>
  <text font-size="16" font-family="Menlo" x="120" fill="black" xml:space="preserve" y="104" text-anchor="start" dominant-baseline="middle">cap = 11                                         </text>
  <text y="200" x="80" font-family="Menlo" xml:space="preserve" fill="black" font-size="16" dominant-baseline="middle" text-anchor="start">myvector.end() </text>
</svg>
<aside class="notes">
<p>And we loop. Is the iteration done? No we still haven't hit the end.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-9" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
&gt;       <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg height="208" width="780" viewBox="0 0 780 208" xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full">
  <path d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="green" stroke-width="2" fill="none" />
  <path d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" fill="none" stroke-width="2" stroke="green" />
  <path stroke="green" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" />
  <path stroke="green" fill="none" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" stroke-width="2" />
  <text dominant-baseline="middle" xml:space="preserve" font-size="16" font-family="Menlo" fill="black" text-anchor="start" y="8" x="80">val = -4                     </text>
  <text y="8" dominant-baseline="middle" font-family="Menlo" fill="black" x="740" font-size="16" xml:space="preserve" text-anchor="start">iter</text>
  <text dominant-baseline="middle" y="56" font-size="16" xml:space="preserve" x="80" font-family="Menlo" text-anchor="start" fill="black">myvector         </text>
  <text dominant-baseline="middle" xml:space="preserve" text-anchor="start" font-size="16" fill="black" x="120" y="72" font-family="Menlo">buf </text>
  <text xml:space="preserve" y="72" font-size="16" x="270" text-anchor="start" fill="black" font-family="Menlo" dominant-baseline="middle">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text y="88" text-anchor="start" font-size="16" font-family="Menlo" x="120" xml:space="preserve" dominant-baseline="middle" fill="black">len = 11     </text>
  <text x="120" text-anchor="start" y="104" fill="black" font-size="16" xml:space="preserve" font-family="Menlo" dominant-baseline="middle">cap = 11                                         </text>
  <text dominant-baseline="middle" xml:space="preserve" y="200" x="80" font-size="16" text-anchor="start" font-family="Menlo" fill="black">myvector.end() </text>
</svg>
<aside class="notes">
<p>So we load the value -4.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-10" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
&gt;       <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="780" height="208" viewBox="0 0 780 208">
  <path fill="none" stroke="green" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke-width="2" />
  <path d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke="green" stroke-width="2" fill="none" />
  <path stroke-width="2" fill="none" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" />
  <path stroke-width="2" stroke="green" fill="none" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" />
  <text font-size="16" y="8" text-anchor="start" font-family="Menlo" x="80" dominant-baseline="middle" xml:space="preserve" fill="black">val = -4                     </text>
  <text text-anchor="start" xml:space="preserve" x="740" font-size="16" fill="black" dominant-baseline="middle" font-family="Menlo" y="8">iter</text>
  <text font-family="Menlo" fill="black" y="56" x="80" dominant-baseline="middle" xml:space="preserve" text-anchor="start" font-size="16">myvector         </text>
  <text fill="black" font-size="16" x="120" xml:space="preserve" font-family="Menlo" y="72" text-anchor="start" dominant-baseline="middle">buf </text>
  <text x="270" font-size="16" y="72" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" fill="black" text-anchor="start">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text font-size="16" font-family="Menlo" x="120" xml:space="preserve" y="88" dominant-baseline="middle" text-anchor="start" fill="black">len = 11     </text>
  <text dominant-baseline="middle" text-anchor="start" y="104" font-size="16" xml:space="preserve" font-family="Menlo" x="120" fill="black">cap = 11                                         </text>
  <text dominant-baseline="middle" font-size="16" text-anchor="start" y="200" x="80" font-family="Menlo" xml:space="preserve" fill="black">myvector.end() </text>
</svg>
<aside class="notes">
<p>And that's negative.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-11" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
&gt;           out.push_back(-val);
        }
    }</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" height="208" version="1.1" width="780" baseProfile="full" viewBox="0 0 780 208">
  <path d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" fill="none" stroke="green" stroke-width="2" />
  <path stroke-width="2" stroke="green" d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" fill="none" />
  <path d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" stroke-width="2" stroke="green" />
  <path stroke="green" d="M 615,104 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 615,128L 615,144L 615,160L 615,176L 615,192Q 615,200 610,200Q 610,200 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" fill="none" stroke-width="2" />
  <text text-anchor="start" y="8" font-family="Menlo" xml:space="preserve" x="80" dominant-baseline="middle" fill="black" font-size="16">val = -4                     </text>
  <text x="740" fill="black" font-family="Menlo" text-anchor="start" y="8" dominant-baseline="middle" xml:space="preserve" font-size="16">iter</text>
  <text xml:space="preserve" x="80" dominant-baseline="middle" text-anchor="start" y="56" font-size="16" fill="black" font-family="Menlo">myvector         </text>
  <text fill="black" xml:space="preserve" dominant-baseline="middle" y="72" text-anchor="start" font-family="Menlo" font-size="16" x="120">buf </text>
  <text y="72" dominant-baseline="middle" xml:space="preserve" font-size="16" fill="black" x="270" font-family="Menlo" text-anchor="start">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text text-anchor="start" y="88" font-family="Menlo" xml:space="preserve" dominant-baseline="middle" font-size="16" x="120" fill="black">len = 11     </text>
  <text dominant-baseline="middle" text-anchor="start" xml:space="preserve" font-family="Menlo" fill="black" y="104" font-size="16" x="120">cap = 11                                         </text>
  <text fill="black" dominant-baseline="middle" y="200" text-anchor="start" x="80" font-size="16" xml:space="preserve" font-family="Menlo">myvector.end() </text>
</svg>
<aside class="notes">
<p>So we push ... but the backing buffer is already full</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-12" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
&gt;           out.push_back(-val);
        }
    }</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 208" width="780" baseProfile="full" version="1.1" height="208">
  <path fill="none" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke="blue" stroke-width="2" id="old" />
  <path fill="none" stroke-width="2" d="M 255,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120L 390,120L 400,120L 410,120L 420,120L 430,120L 440,120L 450,120L 460,120L 470,120L 480,120L 490,120L 500,120L 510,120L 520,120L 530,120L 540,120L 550,120L 560,120L 570,120L 580,120L 590,120L 600,120L 610,120L 620,120L 630,120L 640,120L 650,120L 660,120L 670,120L 680,120L 690,120L 700,120L 710,120L 720,120L 730,120L 740,120L 750,120L 760,120L 765,120L 765,144L 765,152L 750,152L 740,152L 730,152L 720,152L 710,152L 700,152L 690,152L 680,152L 670,152L 660,152L 650,152L 640,152L 630,152L 620,152L 610,152L 600,152L 590,152L 580,152L 570,152L 560,152L 550,152L 540,152L 530,152L 520,152L 510,152L 500,152L 490,152L 480,152L 470,152L 460,152L 450,152L 440,152L 430,152L 420,152L 410,152L 400,152L 390,152L 380,152L 370,152L 360,152L 350,152L 340,152L 330,152L 320,152L 310,152L 300,152L 290,152L 280,152L 270,152L 260,152L 255,152L 255,128 Z" stroke="green" />
  <path stroke="green" fill="none" d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke-width="2" />
  <path stroke="green" stroke-width="2" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" />
  <text font-size="16" xml:space="preserve" dominant-baseline="middle" font-family="Menlo" fill="black" text-anchor="start" x="80" y="8">val = -4                     </text>
  <text dominant-baseline="middle" fill="black" font-family="Menlo" text-anchor="start" font-size="16" y="8" xml:space="preserve" x="740">iter</text>
  <text font-family="Menlo" y="56" xml:space="preserve" dominant-baseline="middle" x="80" text-anchor="start" font-size="16" fill="black">myvector         </text>
  <text y="72" dominant-baseline="middle" font-size="16" fill="black" text-anchor="start" xml:space="preserve" x="120" font-family="Menlo">buf </text>
  <text text-anchor="start" x="270" y="72" fill="black" font-size="16" xml:space="preserve" font-family="Menlo" dominant-baseline="middle">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text fill="black" dominant-baseline="middle" y="88" x="120" font-size="16" font-family="Menlo" xml:space="preserve" text-anchor="start">len = 11     </text>
  <text font-family="Menlo" font-size="16" fill="black" xml:space="preserve" y="104" text-anchor="start" dominant-baseline="middle" x="120">cap = 11</text>
  <text xml:space="preserve" x="80" font-family="Menlo" dominant-baseline="middle" text-anchor="start" y="200" fill="black" font-size="16">myvector.end()</text>
</svg>
<aside class="notes">
<p>Lets tease apart what <code>push_back</code> will do here. It needs to allocate a larger buffer.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-13" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
&gt;           out.push_back(-val);
        }
    }</code></pre></div>
<svg baseProfile="full" width="780" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 780 208" version="1.1" height="208">
  <path stroke="blue" id="old" stroke-width="2" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" fill="none" />
  <path fill="none" d="M 255,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120L 390,120L 400,120L 410,120L 420,120L 430,120L 440,120L 450,120L 460,120L 470,120L 480,120L 490,120L 500,120L 510,120L 520,120L 530,120L 540,120L 550,120L 560,120L 570,120L 580,120L 590,120L 600,120L 610,120L 620,120L 630,120L 640,120L 650,120L 660,120L 670,120L 680,120L 690,120L 700,120L 710,120L 720,120L 730,120L 740,120L 750,120L 760,120L 765,120L 765,144L 765,152L 750,152L 740,152L 730,152L 720,152L 710,152L 700,152L 690,152L 680,152L 670,152L 660,152L 650,152L 640,152L 630,152L 620,152L 610,152L 600,152L 590,152L 580,152L 570,152L 560,152L 550,152L 540,152L 530,152L 520,152L 510,152L 500,152L 490,152L 480,152L 470,152L 460,152L 450,152L 440,152L 430,152L 420,152L 410,152L 400,152L 390,152L 380,152L 370,152L 360,152L 350,152L 340,152L 330,152L 320,152L 310,152L 300,152L 290,152L 280,152L 270,152L 260,152L 255,152L 255,128 Z" stroke="green" stroke-width="2" />
  <path stroke-width="2" d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke="green" fill="none" />
  <path fill="none" stroke="green" d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" />
  <text x="80" font-family="Menlo" dominant-baseline="middle" text-anchor="start" y="8" xml:space="preserve" font-size="16" fill="black">val = -4                     </text>
  <text y="8" dominant-baseline="middle" font-size="16" x="740" font-family="Menlo" fill="black" xml:space="preserve" text-anchor="start">iter</text>
  <text fill="black" font-family="Menlo" x="80" font-size="16" y="56" xml:space="preserve" dominant-baseline="middle" text-anchor="start">myvector         </text>
  <text fill="black" xml:space="preserve" dominant-baseline="middle" font-size="16" font-family="Menlo" x="120" text-anchor="start" y="72">buf </text>
  <text fill="black" text-anchor="start" y="72" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" font-size="16" x="270">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text xml:space="preserve" x="120" text-anchor="start" fill="black" font-size="16" y="88" dominant-baseline="middle" font-family="Menlo">len = 11     </text>
  <text y="104" font-size="16" text-anchor="start" x="120" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" fill="black">cap = 11</text>
  <text y="136" fill="black" font-family="Menlo" x="270" xml:space="preserve" text-anchor="start" font-size="16" dominant-baseline="middle">-1  2  3 -4 -5 -6 -7 -8 -9 10  1                 </text>
  <text dominant-baseline="middle" x="80" xml:space="preserve" text-anchor="start" y="200" font-size="16" font-family="Menlo" fill="black">myvector.end()</text>
</svg>
<aside class="notes">
<p>Then it copies the current contents to the newly allocated buffer.</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-14" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
&gt;           out.push_back(-val);
        }
    }</code></pre></div>
<svg viewBox="0 0 780 208" height="208" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="780">
  <path stroke="blue" fill="none" stroke-width="2" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" id="old" />
  <path d="M 255,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120L 390,120L 400,120L 410,120L 420,120L 430,120L 440,120L 450,120L 460,120L 470,120L 480,120L 490,120L 500,120L 510,120L 520,120L 530,120L 540,120L 550,120L 560,120L 570,120L 580,120L 590,120L 600,120L 610,120L 620,120L 630,120L 640,120L 650,120L 660,120L 670,120L 680,120L 690,120L 700,120L 710,120L 720,120L 730,120L 740,120L 750,120L 760,120L 765,120L 765,144L 765,152L 750,152L 740,152L 730,152L 720,152L 710,152L 700,152L 690,152L 680,152L 670,152L 660,152L 650,152L 640,152L 630,152L 620,152L 610,152L 600,152L 590,152L 580,152L 570,152L 560,152L 550,152L 540,152L 530,152L 520,152L 510,152L 500,152L 490,152L 480,152L 470,152L 460,152L 450,152L 440,152L 430,152L 420,152L 410,152L 400,152L 390,152L 380,152L 370,152L 360,152L 350,152L 340,152L 330,152L 320,152L 310,152L 300,152L 290,152L 280,152L 270,152L 260,152L 255,152L 255,128 Z" stroke="green" stroke-width="2" fill="none" />
  <path d="M 375,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 375,16Q 375,8 380,8Q 380,8 390,8L 400,8L 410,8L 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" stroke="green" stroke-width="2" fill="none" />
  <path d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 245,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" stroke="green" fill="none" />
  <text text-anchor="start" dominant-baseline="middle" y="8" xml:space="preserve" x="80" font-family="Menlo" font-size="16" fill="black">val = -4                     </text>
  <text dominant-baseline="middle" fill="black" xml:space="preserve" font-family="Menlo" x="740" font-size="16" y="8" text-anchor="start">iter</text>
  <text xml:space="preserve" x="80" y="56" font-family="Menlo" font-size="16" text-anchor="start" dominant-baseline="middle" fill="black">myvector         </text>
  <text dominant-baseline="middle" y="72" font-family="Menlo" fill="black" xml:space="preserve" text-anchor="start" x="120" font-size="16">buf </text>
  <text y="72" font-size="16" x="270" xml:space="preserve" fill="black" text-anchor="start" dominant-baseline="middle" font-family="Menlo">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text x="120" dominant-baseline="middle" fill="black" y="88" text-anchor="start" font-family="Menlo" font-size="16" xml:space="preserve">len = 11     </text>
  <text font-family="Menlo" fill="black" x="120" y="104" text-anchor="start" font-size="16" dominant-baseline="middle" xml:space="preserve">cap = 11</text>
  <text fill="black" x="270" text-anchor="start" font-family="Menlo" font-size="16" dominant-baseline="middle" y="136" xml:space="preserve">-1  2  3 -4 -5 -6 -7 -8 -9 10  1  4              </text>
  <text font-family="Menlo" y="200" text-anchor="start" font-size="16" fill="black" dominant-baseline="middle" xml:space="preserve" x="80">myvector.end()</text>
</svg>
<aside class="notes">
<p>We finally push the value <code>4</code> onto the end, and we will also need to adjust <code>buf</code>, <code>len</code>, and <code>cap</code> (to point at the newly allocated buffer, with its new length and larger capacity).</p>
</aside>
</section><section id="c-bugs-yield-undefined-behavior-15" class="slide level2" data-transition="fade">
<h2>C++: Bugs yield Undefined Behavior</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">&gt;   <span class="cf">for</span> (<span class="kw">auto</span> it = input.begin(); it != input.end(); ++it) {
        <span class="kw">auto</span> val = *it;
        <span class="cf">if</span> (val &lt; <span class="dv">0</span>) {
            out.push_back(-val);
        }
    }</code></pre></div>
<svg viewBox="0 0 780 208" baseProfile="full" width="780" height="208" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" d="M 255,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 430,56L 440,56L 450,56L 460,56L 470,56L 480,56L 490,56L 500,56L 510,56L 520,56L 530,56L 540,56L 550,56L 560,56L 570,56L 580,56L 590,56L 600,56L 605,56L 605,80L 605,88L 590,88L 580,88L 570,88L 560,88L 550,88L 540,88L 530,88L 520,88L 510,88L 500,88L 490,88L 480,88L 470,88L 460,88L 450,88L 440,88L 430,88L 420,88L 410,88L 400,88L 390,88L 380,88L 370,88L 360,88L 350,88L 340,88L 330,88L 320,88L 310,88L 300,88L 290,88L 280,88L 270,88L 260,88L 255,88L 255,64 Z" stroke-width="2" stroke-dasharray="5,2" stroke="blue" id="old" />
  <path fill="none" stroke="green" stroke-width="2" d="M 255,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120L 390,120L 400,120L 410,120L 420,120L 430,120L 440,120L 450,120L 460,120L 470,120L 480,120L 490,120L 500,120L 510,120L 520,120L 530,120L 540,120L 550,120L 560,120L 570,120L 580,120L 590,120L 600,120L 610,120L 620,120L 630,120L 640,120L 650,120L 660,120L 670,120L 680,120L 690,120L 700,120L 710,120L 720,120L 730,120L 740,120L 750,120L 760,120L 765,120L 765,144L 765,152L 750,152L 740,152L 730,152L 720,152L 710,152L 700,152L 690,152L 680,152L 670,152L 660,152L 650,152L 640,152L 630,152L 620,152L 610,152L 600,152L 590,152L 580,152L 570,152L 560,152L 550,152L 540,152L 530,152L 520,152L 510,152L 500,152L 490,152L 480,152L 470,152L 460,152L 450,152L 440,152L 430,152L 420,152L 410,152L 400,152L 390,152L 380,152L 370,152L 360,152L 350,152L 340,152L 330,152L 320,152L 310,152L 300,152L 290,152L 280,152L 270,152L 260,152L 255,152L 255,128 Z" />
  <path d="M 405,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 405,16Q 405,8 410,8Q 410,8 420,8L 430,8L 440,8L 450,8L 460,8L 470,8L 480,8L 490,8L 500,8L 510,8L 520,8L 530,8L 540,8L 550,8L 560,8L 570,8L 580,8L 590,8L 600,8L 610,8L 620,8L 630,8L 640,8L 650,8L 660,8L 670,8L 680,8L 690,8L 700,8L 710,8L 720,8L 730,8" id="iter" stroke="red" stroke-width="2" fill="none" />
  <path d="M 160,72 L 170,72L 180,72L 190,72L 200,72L 210,72Q 215,72 215,80L 215,96L 215,112L 215,128Q 215,136 220,136Q 220,136 230,136L 240,136L 245,136 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" stroke="green" />
  <path stroke-width="2" d="M 645,168 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 645,192Q 645,200 640,200Q 640,200 630,200L 620,200L 610,200L 600,200L 590,200L 580,200L 570,200L 560,200L 550,200L 540,200L 530,200L 520,200L 510,200L 500,200L 490,200L 480,200L 470,200L 460,200L 450,200L 440,200L 430,200L 420,200L 410,200L 400,200L 390,200L 380,200L 370,200L 360,200L 350,200L 340,200L 330,200L 320,200L 310,200L 300,200L 290,200L 280,200L 270,200L 260,200L 250,200L 240,200L 230,200" stroke="green" fill="none" />
  <text y="8" dominant-baseline="middle" x="740" text-anchor="start" font-family="Menlo" fill="black" font-size="16" xml:space="preserve">iter</text>
  <text font-size="16" text-anchor="start" xml:space="preserve" fill="black" font-family="Menlo" x="80" dominant-baseline="middle" y="56">myvector         </text>
  <text font-size="16" x="120" y="72" dominant-baseline="middle" font-family="Menlo" fill="black" text-anchor="start" xml:space="preserve">buf </text>
  <text xml:space="preserve" fill="black" x="270" text-anchor="start" font-family="Menlo" font-size="16" y="72" dominant-baseline="middle">-1  2  3 -4 -5 -6 -7 -8 -9 10  1 </text>
  <text text-anchor="start" y="88" fill="black" xml:space="preserve" font-family="Menlo" font-size="16" x="120" dominant-baseline="middle">len = 12 </text>
  <text font-size="16" x="120" dominant-baseline="middle" xml:space="preserve" fill="black" text-anchor="start" y="104" font-family="Menlo">cap = 16 </text>
  <text dominant-baseline="middle" x="270" font-size="16" font-family="Menlo" xml:space="preserve" y="136" text-anchor="start" fill="black">-1  2  3 -4 -5 -6 -7 -8 -9 10  1  4              </text>
  <text y="200" x="80" text-anchor="start" font-family="Menlo" font-size="16" xml:space="preserve" fill="black" dominant-baseline="middle">myvector.end() </text>
</svg>
<aside class="notes">
<p>But <code>push_back</code> didn't know about <code>iter</code>. Things have gone terribly terribly wrong. (This is called &quot;Iterator Invalidation&quot; in C++. It is considered programmer error.)</p>
<p>Note typical results are largely dependent on memory allocator (e.g. how soon old buffer is overwritten or returned to OS, and what its memory address range is relative to the new buffer).</p>
</aside>
</section><section id="c-chose-speed-over-safety" class="slide level2 center">
<h2>C++ chose speed over safety</h2>
<p>Iterator invalidation yields undefined behavior</p>
</section><section id="java-has-iterator-invalidation-too" class="slide level2">
<h2>Java has Iterator Invalidation too</h2>
<p>Analogous code in Java</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt; myvector = <span class="kw">new</span> <span class="bu">ArrayList</span>&lt;<span class="bu">Integer</span>&gt;(input);
myvector.<span class="fu">addAll</span>(<span class="bu">Arrays</span>.<span class="fu">asList</span>(values));
<span class="fu">gather_negs</span>(myvector, myvector);</code></pre></div>
<p>yields <code>ConcurrentModificationException</code> at runtime.</p>
<div class="fragment">
<p>(So Java remains safe; its collection code dynamically checks to detect iterator invalidation. Programmer's bug is detected at runtime.)</p>
</div>
</section><section id="rust-1" class="slide level2">
<h2>Rust</h2>
<p>Analogous code in Rust</p>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">let</span> <span class="kw">mut</span> myvector = <span class="dt">Vec</span>::new();
myvector.extend(values.iter());
gather_negatives(&amp;myvector,
                 &amp;<span class="kw">mut</span> myvector  );</code></pre></div>
<div class="fragment">
<p>yields:</p>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust">error: cannot borrow `myvector` <span class="kw">as</span> mutable 
  because it is also borrowed <span class="kw">as</span> immutable
  --&gt; examples/vex.rs:<span class="dv">18</span>:<span class="dv">27</span>
   |
<span class="dv">17</span> |     gather_negatives(&amp;myvector,
   |                       -------- immutable borrow occurs here
<span class="dv">18</span> |                      &amp;<span class="kw">mut</span> myvector  );
   |                           ^^^^^^^^  - immutable borrow ends here
   |                           |
   |                           mutable borrow occurs here

error: aborting due to previous error</code></pre></div>
<p>at <em>compile-time</em>.</p>
</div>
</section><section id="safe-code-means-no-undefined-behavior" class="slide level2 left_align">
<h2>Safe code means no undefined behavior</h2>
<ul>
<li class="fragment">Compiler rejects code that does unsafe things, when feasible</li>
</ul>
<ul>
<li class="fragment">Developer must explicitly opt into use of <code>unsafe</code> constructs, like raw pointer addresses</li>
</ul>
<ul>
<li class="fragment">Some things checked at runtime (e.g. array bounds checks); errors here yield &quot;panics&quot;</li>
</ul>
<ul>
<li class="fragment">No undefined behavior; but unwinds/aborts are allowed</li>
</ul>
</section></section>
<section><section id="lets-jump-in-parallelism" class="titleslide slide level1 center"><h1>Let's Jump In: Parallelism</h1></section><section id="example-sum-of-even-numbers-in-c" class="slide level2">
<h2>Example: Sum of (even) numbers in C++</h2>
<p>Core function to add the even values in an integer range.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">uint64_t</span> do_partial_sum(<span class="dt">int</span> start, <span class="dt">int</span> to_do) {
    <span class="dt">uint64_t</span> result = <span class="dv">0</span>;
    <span class="cf">for</span> (<span class="dt">int</span> i = start; i &lt; start + to_do; i++) {
        <span class="cf">if</span> (i % <span class="dv">2</span> == <span class="dv">0</span>) { <span class="co">// avoid compiler reduction to closed form solution</span>
            result += i;
        }
    }
    <span class="cf">return</span> result;
}</code></pre></div>
</section><section id="parallelize-it-divide-and-conquer" class="slide level2">
<h2>Parallelize it: Divide and conquer!</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> thread_work(<span class="dt">uint64_t</span> *result, <span class="dt">int</span> start, <span class="dt">int</span> to_do) {
    *result += do_partial_sum(start, to_do);
}

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[]) {
    <span class="dt">uint64_t</span> result;
    <span class="co">/* ... */</span>
    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>thread *&gt; threads;
    result = <span class="dv">0</span>;
    <span class="cf">for</span> (<span class="dt">int</span> start_val = <span class="dv">0</span>, i = <span class="dv">0</span>;
         start_val &lt; max;
         start_val += sum_per_thread, i++) {
        threads.push_back(<span class="kw">new</span> <span class="bu">std::</span>thread(thread_work,
                                          &amp;result,
                                          start_val,
                                          sum_per_thread));
    }
    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; thread_count; i++) {
        threads[i]-&gt;join();
    }
    <span class="co">/* ... */</span>
}</code></pre></div>
</section><section id="lets-try-it" class="slide level2 center">
<h2>Let's try it!</h2>
<p>(I know you're aching to see more Rust; we'll get to it!)</p>
</section><section id="lets-try-our-c-code" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th>average time</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td>(TBD)</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td>(TBD)</td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td>(TBD)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Four runs, 1 thread</p>
<svg viewBox="0 0 490 128" baseProfile="full" width="490" xmlns="http://www.w3.org/2000/svg" version="1.1" height="128">
  <text dominant-baseline="middle" xml:space="preserve" x="0" font-family="Menlo" font-size="16" fill="black" y="8" text-anchor="start">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" font-size="16" y="24" font-family="Menlo" text-anchor="start" fill="black" dominant-baseline="middle" xml:space="preserve">time 0.474006s</text>
  <text font-family="Menlo" dominant-baseline="middle" text-anchor="start" y="40" fill="black" x="0" xml:space="preserve" font-size="16">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text fill="black" xml:space="preserve" font-size="16" text-anchor="start" x="0" y="56" dominant-baseline="middle" font-family="Menlo">time 0.429937s</text>
  <text xml:space="preserve" font-size="16" fill="black" y="72" x="0" dominant-baseline="middle" font-family="Menlo" text-anchor="start">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text xml:space="preserve" y="88" font-family="Menlo" dominant-baseline="middle" text-anchor="start" font-size="16" fill="black" x="0">time 0.430296s</text>
  <text text-anchor="start" x="0" fill="black" font-family="Menlo" dominant-baseline="middle" y="104" xml:space="preserve" font-size="16">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" dominant-baseline="middle" text-anchor="start" fill="black" font-size="16" y="120" xml:space="preserve" font-family="Menlo">time 0.425924s</text>
</svg>
</section><section id="lets-try-our-c-code-1" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th>average time</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td>0.44004075</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td>(TBD)</td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td>(TBD)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Four runs, 1 thread</p>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="128" viewBox="0 0 490 128" baseProfile="full" width="490">
  <text font-family="Menlo" fill="black" x="0" font-size="16" y="8" dominant-baseline="middle" xml:space="preserve" text-anchor="start">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" dominant-baseline="middle" xml:space="preserve" y="24" fill="black" font-size="16" text-anchor="start" font-family="Menlo">time 0.474006s</text>
  <text font-size="16" x="0" y="40" dominant-baseline="middle" font-family="Menlo" text-anchor="start" fill="black" xml:space="preserve">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text xml:space="preserve" text-anchor="start" fill="black" dominant-baseline="middle" font-size="16" x="0" font-family="Menlo" y="56">time 0.429937s</text>
  <text text-anchor="start" fill="black" xml:space="preserve" font-size="16" dominant-baseline="middle" font-family="Menlo" x="0" y="72">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text font-size="16" text-anchor="start" x="0" xml:space="preserve" font-family="Menlo" y="88" fill="black" dominant-baseline="middle">time 0.430296s</text>
  <text font-size="16" fill="black" text-anchor="start" font-family="Menlo" xml:space="preserve" x="0" dominant-baseline="middle" y="104">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text xml:space="preserve" font-size="16" font-family="Menlo" y="120" fill="black" dominant-baseline="middle" x="0" text-anchor="start">time 0.425924s</text>
</svg>
</section><section id="lets-try-our-c-code-2" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th>average time</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td>0.44004075</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td>(TBD)</td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td>(TBD)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Four runs, 4 threads</p>
<svg height="128" viewBox="0 0 490 128" baseProfile="full" xmlns="http://www.w3.org/2000/svg" version="1.1" width="490">
  <text x="0" fill="black" xml:space="preserve" text-anchor="start" font-size="16" y="8" dominant-baseline="middle" font-family="Menlo">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" font-family="Menlo" font-size="16" xml:space="preserve" text-anchor="start" y="24" dominant-baseline="middle" fill="black">time 0.154396s</text>
  <text y="40" x="0" dominant-baseline="middle" font-size="16" xml:space="preserve" text-anchor="start" fill="black" font-family="Menlo">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text y="56" xml:space="preserve" x="0" font-family="Menlo" text-anchor="start" dominant-baseline="middle" fill="black" font-size="16">time 0.156933s</text>
  <text dominant-baseline="middle" text-anchor="start" fill="black" y="72" xml:space="preserve" font-size="16" font-family="Menlo" x="0">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text xml:space="preserve" y="88" text-anchor="start" dominant-baseline="middle" x="0" font-family="Menlo" fill="black" font-size="16">time 0.166546s</text>
  <text fill="black" text-anchor="start" font-size="16" dominant-baseline="middle" x="0" y="104" font-family="Menlo" xml:space="preserve">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text fill="black" font-family="Menlo" font-size="16" dominant-baseline="middle" text-anchor="start" xml:space="preserve" y="120" x="0">time 0.153196s</text>
</svg>
</section><section id="lets-try-our-c-code-3" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th>average time</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td>0.44004075</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td>0.15776775</td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td>(TBD)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Four runs, 4 threads</p>
<svg xmlns="http://www.w3.org/2000/svg" width="490" height="128" baseProfile="full" version="1.1" viewBox="0 0 490 128">
  <text dominant-baseline="middle" font-family="Menlo" x="0" text-anchor="start" fill="black" font-size="16" xml:space="preserve" y="8">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text fill="black" text-anchor="start" dominant-baseline="middle" y="24" font-size="16" x="0" xml:space="preserve" font-family="Menlo">time 0.154396s</text>
  <text x="0" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" y="40" text-anchor="start" font-size="16" fill="black">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text fill="black" font-family="Menlo" dominant-baseline="middle" xml:space="preserve" y="56" x="0" font-size="16" text-anchor="start">time 0.156933s</text>
  <text y="72" font-family="Menlo" xml:space="preserve" fill="black" text-anchor="start" dominant-baseline="middle" font-size="16" x="0">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text font-family="Menlo" x="0" fill="black" dominant-baseline="middle" y="88" text-anchor="start" font-size="16" xml:space="preserve">time 0.166546s</text>
  <text xml:space="preserve" text-anchor="start" x="0" dominant-baseline="middle" font-size="16" y="104" fill="black" font-family="Menlo">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text dominant-baseline="middle" x="0" text-anchor="start" xml:space="preserve" fill="black" y="120" font-family="Menlo" font-size="16">time 0.153196s</text>
</svg>
</section><section id="lets-try-our-c-code-4" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th>average time</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td>0.44004075</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td>0.15776775</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td>(TBD)</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Four runs, 1000 threads</p>
<svg xmlns="http://www.w3.org/2000/svg" baseProfile="full" viewBox="0 0 490 128" version="1.1" width="490" height="128">
  <text dominant-baseline="middle" font-family="Menlo" y="8" font-size="16" xml:space="preserve" x="0" text-anchor="start" fill="black">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text xml:space="preserve" text-anchor="start" dominant-baseline="middle" font-size="16" fill="black" font-family="Menlo" x="0" y="24">time 0.134191s</text>
  <text x="0" fill="black" y="40" xml:space="preserve" font-size="16" text-anchor="start" font-family="Menlo" dominant-baseline="middle">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text font-size="16" x="0" fill="black" text-anchor="start" dominant-baseline="middle" y="56" font-family="Menlo" xml:space="preserve">time 0.137994s</text>
  <text fill="black" font-size="16" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" y="72" text-anchor="start" x="0">sum of 0 to 1000000000 result: 249850749500500000</text>
  <text text-anchor="start" font-family="Menlo" font-size="16" fill="black" xml:space="preserve" y="88" dominant-baseline="middle" x="0">time 0.135118s</text>
  <text fill="black" font-family="Menlo" font-size="16" text-anchor="start" y="104" x="0" xml:space="preserve" dominant-baseline="middle">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" dominant-baseline="middle" font-size="16" font-family="Menlo" xml:space="preserve" fill="black" y="120" text-anchor="start">time 0.134177s</text>
</svg>
</section><section id="lets-try-our-c-code-5" class="slide level2" data-transition="fade">
<h2>Let's try our C++ code</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">threads</th>
<th style="text-align: left;">average time</th>
<th style="text-align: left;">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;"><del>0.44004075</del></td>
<td style="text-align: left;">(but</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;"><del>0.15776775</del></td>
<td style="text-align: left;">its all</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1000</td>
<td style="text-align: left;"><del>0.13537</del></td>
<td style="text-align: left;">bogus!)</td>
</tr>
</tbody>
</table>
<p>Four runs, 1000 threads</p>
<svg viewBox="0 0 490 128" height="128" version="1.1" xmlns="http://www.w3.org/2000/svg" width="490" baseProfile="full">
  <path stroke="red" id="uhoh" d="M 360,88 L 370,88L 380,88L 390,88L 400,88L 410,88L 420,88L 430,88" stroke-width="2" fill="none" />
  <text fill="black" xml:space="preserve" dominant-baseline="middle" x="0" text-anchor="start" font-size="16" font-family="Menlo" y="8">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text x="0" font-family="Menlo" dominant-baseline="middle" xml:space="preserve" y="24" text-anchor="start" font-size="16" fill="black">time 0.134191s</text>
  <text x="0" text-anchor="start" fill="black" font-family="Menlo" xml:space="preserve" font-size="16" dominant-baseline="middle" y="40">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text dominant-baseline="middle" y="56" xml:space="preserve" text-anchor="start" fill="black" font-size="16" x="0" font-family="Menlo">time 0.137994s</text>
  <text text-anchor="start" dominant-baseline="middle" font-family="Menlo" x="0" font-size="16" fill="black" y="72" xml:space="preserve">sum of 0 to 1000000000 result: 249850749500500000</text>
  <text text-anchor="start" x="0" font-size="16" fill="black" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" y="88">time 0.135118s                      </text>
  <text xml:space="preserve" font-size="16" text-anchor="start" font-family="Menlo" x="0" fill="black" dominant-baseline="middle" y="104">sum of 0 to 1000000000 result: 249999999500000000</text>
  <text dominant-baseline="middle" y="120" font-size="16" xml:space="preserve" font-family="Menlo" fill="black" text-anchor="start" x="0">time 0.134177s</text>
</svg>
</section><section id="data-race" class="slide level2 center">
<h2>Data Race!</h2>
</section><section id="data-race-1" class="slide level2">
<h2>Data Race!</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> thread_work(<span class="dt">uint64_t</span> *result, <span class="dt">int</span> start, <span class="dt">int</span> to_do) {
    *result += do_partial_sum(start, to_do);
 <span class="co">// ~~~~~~~</span>
}

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> *argv[]) {
    <span class="dt">uint64_t</span> result;
    <span class="co">/* ... */</span>
    <span class="bu">std::</span>vector&lt;<span class="bu">std::</span>thread *&gt; threads;
    result = <span class="dv">0</span>;
    <span class="cf">for</span> (<span class="dt">int</span> start_val = <span class="dv">0</span>, i = <span class="dv">0</span>;
         start_val &lt; max;
         start_val += sum_per_thread, i++) {
        <span class="kw">auto</span> result_ptr = &amp;result;
                       <span class="co">// ~~~~~~~</span>
        threads.push_back(<span class="kw">new</span> <span class="bu">std::</span>thread(thread_work,
                                          result_ptr,
                                          start_val,
                                          sum_per_thread));
    }
    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; thread_count; i++) {
        threads[i]-&gt;join();
    }
    <span class="co">/* ... */</span>
}</code></pre></div>
</section><section id="analogous-code-in-rust" class="slide level2">
<h2>Analogous code in Rust</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> do_partial_sum(start: <span class="dt">isize</span>, to_do: <span class="dt">isize</span>) -&gt; <span class="dt">u64</span> <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> result: <span class="dt">u64</span> = <span class="dv">0</span>;
    <span class="kw">for</span> i <span class="kw">in</span> start..(start + to_do) <span class="op">{</span>
        <span class="kw">if</span> i % <span class="dv">2</span> == <span class="dv">0</span> <span class="op">{</span>
            result += i <span class="kw">as</span> <span class="dt">u64</span>;
        <span class="op">}</span>
    <span class="op">}</span>
    <span class="kw">return</span> result;
<span class="op">}</span></code></pre></div>
<div class="fragment">
<p>or if you prefer</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> do_partial_sum_alt(start: <span class="dt">isize</span>, to_do: <span class="dt">isize</span>) -&gt; <span class="dt">u64</span> <span class="op">{</span>
    (start..(start + to_do)).filter(|i| i % <span class="dv">2</span> == <span class="dv">0</span>).map(|i| i <span class="kw">as</span> <span class="dt">u64</span>).sum()
<span class="op">}</span></code></pre></div>
</div>
</section><section id="parallelized" class="slide level2">
<h2>Parallelized</h2>
<p>(Attempt at analogous code, now in Rust.)</p>
<!--
```rust
fn main() {
    let sum_per_thread = 250000000;
    let max = 1000000000;
    let mut result: u64;
```
-->
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">let</span> <span class="kw">mut</span> threads = <span class="dt">Vec</span>::new();
result = <span class="dv">0</span>;
::crossbeam::scope(|scope| <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> start_val = <span class="dv">0</span>;
    <span class="kw">while</span> start_val &lt; max <span class="op">{</span>
        <span class="kw">let</span> result_ptr = &amp;<span class="kw">mut</span> result;
        threads.push(scope.spawn(<span class="kw">move</span> || <span class="op">{</span>
            *result_ptr += do_partial_sum(start_val, sum_per_thread);
        <span class="op">}</span>));
        start_val += sum_per_thread;
    <span class="op">}</span>
    <span class="kw">for</span> thread <span class="kw">in</span> threads <span class="op">{</span>
        thread.join();
    <span class="op">}</span>
<span class="op">}</span>);</code></pre></div>
<!--
```rust
}
```
-->
</section><section id="no-data-races-allowed" class="slide level2">
<h2>No data races allowed!</h2>
<pre><code>error: cannot borrow `*result` as mutable more than once at a time
   --&gt; src/a01_opening.rs:963:31
    |
960 | ::crossbeam::scope(|scope| {
...
962 |     while start_val &lt; max {
    |
963 |         let result_ptr = &amp;mut result;
    |                               ^^^^^^
    |                               |
    |                               second mutable borrow occurs here
    |                               first mutable borrow occurs here
...
972 | });
    | - first borrow ends here

error: aborting due to previous error</code></pre>
</section><section id="eliminating-the-race" class="slide level2 left_align">
<h2>Eliminating the race</h2>
<ul>
<li>In both C++ and in Rust, you can easily eliminate the data race</li>
</ul>
<ul>
<li class="fragment">common approach: can wrap a mutex around <code>result</code></li>
<li class="fragment">better: use atomic operation (e.g. compare-and-swap, fetch-and-add)</li>
<li class="fragment">better still: use separate result receiver for each thread, then add those up at end.</li>
</ul>
<ul>
<li><p>Point is: Rust <em>forces</em> you to resolve this bug</p></li>
<li><p>C++ allows silent, scheduler dependent failure (which may arise only rarely)</p></li>
</ul>
</section></section>
<section><section id="why-...-continued" class="titleslide slide level1 center"><h1>Why ...? (continued)</h1></section><section id="why-would-mozilla-sponsor-rust" class="slide level2 center">
<h2>Why would Mozilla sponsor Rust?</h2>
<ul>
<li class="fragment">Hard to prototype research-y browser changes atop C++ code base</li>
</ul>
<ul>
<li class="fragment">Rust  Servo, WebRender</li>
</ul>
<ul>
<li class="fragment">Want Rust for next-gen infrastructure (services, IoT)</li>
</ul>
<ul>
<li class="fragment"><blockquote>
<p>&quot;Our mission is to ensure the Internet is a global public resource, open and accessible to all. An Internet that truly puts people first, where individuals can shape their own experience and are empowered, safe and independent.&quot;</p>
</blockquote></li>
</ul>
<ul>
<li class="fragment">&quot;accessible to all&quot;: IMO, Rust may &quot;bring system programming to the masses&quot;</li>
</ul>
</section></section>
<section><section id="where-is-rust-now" class="titleslide slide level1 center"><h1>Where is Rust now?</h1></section><section id="where-is-rust-now-1" class="slide level2 center">
<h2>Where is Rust now?</h2>
<ul>
<li><p>1.0 release was back in May 2015</p></li>
<li><p>Rolling release cycle (up to Rust 1.16 as of March 16nd 2017)</p></li>
<li><p>Open source from the begining <code>https://github.com/rust-lang/rust/</code></p></li>
<li><p>Open model for future change (RFC process) <code>https://github.com/rust-lang/rfcs/</code></p></li>
<li><p>Awesome developer community (~1,400 people in <code>#rust</code>, ~300 people in <code>#rust-internals</code>, ~1,900 unique commiters to rust.git)</p></li>
</ul>
</section></section>
<section><section id="talk-plan" class="titleslide slide level1 center"><h1>Talk plan</h1></section><section id="talk-plan-1" class="slide level2 center">
<h2>Talk plan</h2>
<ul>
<li class="fragment">Demonstration, &quot;Why Rust&quot;</li>
<li class="fragment">&quot;Ownership is easy&quot; (... or is it?)</li>
<li class="fragment">Sharing (Data) between Threads</li>
<li class="fragment">Sharing (Libraries) between People</li>
</ul>
</section></section>
<section><section id="some-white-lies-rust-is-just-about-ownership" class="titleslide slide level1 center"><h1>some (white) lies: &quot;Rust is just about ownership&quot;</h1></section></section>
<section><section id="ownership-is-intuitive" class="titleslide slide level1 center"><h1>&quot;Ownership is intuitive&quot;</h1></section><section id="ownership-is-intuitive-1" class="slide level2" data-transition="fade-out">
<h2>&quot;Ownership is intuitive&quot;</h2>
<p>Let's buy a car</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> money: Money = bank.withdraw_cash();</code></pre></div>
<svg viewBox="0 0 250 128" xmlns="http://www.w3.org/2000/svg" version="1.1" width="250" height="128" baseProfile="full">
  <path d="M 35,56 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 35,32Q 35,24 40,24Q 40,24 50,24L 60,24L 70,24L 80,24" stroke-width="2" stroke="green" fill="none" />
  <text font-family="Menlo" dominant-baseline="middle" text-anchor="start" y="8" font-size="16" x="20" fill="black" xml:space="preserve">US   BANK    DEALERSHIP</text>
  <text fill="black" font-family="Menlo" y="56" x="50" font-size="16" text-anchor="start" dominant-baseline="middle" xml:space="preserve">money</text>
  <text x="0" fill="black" dominant-baseline="middle" text-anchor="start" xml:space="preserve" font-family="Menlo" y="104" font-size="64" id="money"></text>
</svg>
</section><section id="ownership-is-intuitive-2" class="slide level2" data-transition="fade-out">
<h2>&quot;Ownership is intuitive&quot;</h2>
<p>Let's buy a car</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> money: Money = bank.withdraw_cash();
<span class="kw">let</span> my_new_car: Car = dealership.buy_car(money);</code></pre></div>
<svg baseProfile="full" version="1.1" xmlns="http://www.w3.org/2000/svg" height="208" width="330" viewBox="0 0 330 208">
  <path stroke="green" fill="none" d="M 25,56 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 25,32Q 25,24 30,24Q 30,24 40,24L 50,24L 60,24L 70,24L 80,24L 90,24" stroke-width="2" />
  <path d="M 25,80 L 25,96Q 25,104 30,104Q 30,104 40,104L 50,104L 60,104L 70,104L 80,104L 90,104L 100,104L 110,104L 120,104L 130,104L 140,104L 150,104L 160,104L 170,104L 180,104L 190,104L 195,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" stroke="green" stroke-width="2" />
  <path stroke-width="2" fill="none" stroke="green" d="M 25,152 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 25,128Q 25,120 30,120Q 30,120 40,120L 50,120L 60,120L 70,120L 80,120L 90,120L 100,120L 110,120L 120,120L 130,120L 140,120L 150,120L 160,120L 170,120" />
  <text xml:space="preserve" x="10" font-size="16" text-anchor="start" y="8" fill="black" dominant-baseline="middle" font-family="Menlo">US   BANK    DEALERSHIP</text>
  <text y="56" font-size="16" font-family="Menlo" xml:space="preserve" x="40" text-anchor="start" fill="black" dominant-baseline="middle">money</text>
  <text font-family="Menlo" fill="black" xml:space="preserve" font-size="16" dominant-baseline="middle" x="210" y="104" text-anchor="start">"thank you"</text>
  <text dominant-baseline="middle" font-size="16" y="152" font-family="Menlo" x="80" text-anchor="start" xml:space="preserve" fill="black">my_new_car</text>
  <text fill="black" dominant-baseline="middle" font-size="64" id="car" x="0" text-anchor="start" xml:space="preserve" font-family="Menlo" y="184"></text>
</svg>
<p>money transferred into <code>dealership</code>, and car transferred to us.</p>
<div class="fragment">
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">let</span> second_car = dealership.buy_car(money); <span class="co">// &lt;-- cannot reuse</span></code></pre></div>
</div>
</section><section id="ownership-is-intuitive-3" class="slide level2" data-transition="fade">
<h2>&quot;Ownership is intuitive&quot;</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> money: Money = bank.withdraw_cash();
<span class="kw">let</span> my_new_car: Car = dealership.buy_car(money);
<span class="co">// let second_car = dealership.buy_car(money); // &lt;-- cannot reuse</span>
my_new_car.drive_to(home);
garage.park(my_new_car);</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="224" width="340" baseProfile="full" viewBox="0 0 340 224">
  <path fill="none" stroke="green" d="M 5,56 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 5,32Q 5,24 10,24Q 10,24 20,24L 30,24L 40,24L 50,24L 60,24L 70,24L 80,24" stroke-width="2" />
  <path stroke="green" d="M 5,80 L 5,96Q 5,104 10,104Q 10,104 20,104L 30,104L 40,104L 50,104L 60,104L 70,104L 80,104L 90,104L 100,104L 110,104L 120,104L 130,104L 140,104L 150,104L 160,104L 170,104L 175,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" />
  <path fill="none" d="M 5,152 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 5,128Q 5,120 10,120Q 10,120 20,120L 30,120L 40,120L 50,120L 60,120L 70,120L 80,120L 90,120L 100,120L 110,120L 120,120L 130,120L 140,120L 150,120" stroke-width="2" stroke="green" />
  <path d="M 5,176 L 5,192Q 5,200 10,200Q 10,200 20,200L 30,200L 40,200L 50,200L 60,200L 70,200L 80,200L 90,200L 100,200L 110,200L 120,200L 130,200L 140,200L 150,200L 160,200L 170,200L 180,200L 190,200L 200,200L 210,200L 220,200L 230,200L 240,200L 250,200L 255,200 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" stroke="green" />
  <text xml:space="preserve" x="0" font-size="16" text-anchor="start" fill="black" font-family="Menlo" y="8" dominant-baseline="middle">US    BANK    DEALERSHIP    GARAGE</text>
  <text y="56" text-anchor="start" fill="black" font-size="16" xml:space="preserve" x="20" font-family="Menlo" dominant-baseline="middle">money</text>
  <text font-family="Menlo" text-anchor="start" font-size="16" xml:space="preserve" x="190" dominant-baseline="middle" fill="black" y="104"></text>
  <text y="152" font-family="Menlo" xml:space="preserve" x="20" font-size="16" dominant-baseline="middle" fill="black" text-anchor="start">my_new_car</text>
  <text x="270" fill="black" id="car" xml:space="preserve" text-anchor="start" y="200" font-size="64" dominant-baseline="middle" font-family="Menlo"></text>
</svg>
<div class="fragment">
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust">my_new_car.drive_to(...) <span class="co">// doesn&#39;t work either (reuse again)</span></code></pre></div>
<p>(can't drive car without access to it, e.g. taking it out of the garage)</p>
</div>
</section><section id="ownership-is-intuitive-4" class="slide level2" data-transition="fade-in">
<h2>&quot;Ownership is intuitive&quot;</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> money: Money = bank.withdraw_cash();
<span class="kw">let</span> my_new_car: Car = dealership.buy_car(money);
<span class="co">// let second_car = dealership.buy_car(money); // &lt;-- cannot reuse</span>
my_new_car.drive_to(home);
garage.park(my_new_car);
<span class="co">// my_new_car.drive_to(...) // doesn&#39;t work either (reuse again)</span>
<span class="kw">let</span> my_car = garage.unpark();
my_car.drive_to(work);</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" baseProfile="full" version="1.1" height="288" width="340" viewBox="0 0 340 288">
  <path fill="none" stroke="green" stroke-width="2" d="M 5,56 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 5,32Q 5,24 10,24Q 10,24 20,24L 30,24L 40,24L 50,24L 60,24L 70,24L 80,24" />
  <path stroke="green" d="M 5,80 L 5,96Q 5,104 10,104Q 10,104 20,104L 30,104L 40,104L 50,104L 60,104L 70,104L 80,104L 90,104L 100,104L 110,104L 120,104L 130,104L 140,104L 150,104L 160,104L 170,104L 175,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" fill="none" />
  <path d="M 5,152 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 5,128Q 5,120 10,120Q 10,120 20,120L 30,120L 40,120L 50,120L 60,120L 70,120L 80,120L 90,120L 100,120L 110,120L 120,120L 130,120L 140,120L 150,120" stroke="green" stroke-width="2" fill="none" />
  <path stroke-width="2" d="M 5,176 L 5,192Q 5,200 10,200Q 10,200 20,200L 30,200L 40,200L 50,200L 60,200L 70,200L 80,200L 90,200L 100,200L 110,200L 120,200L 130,200L 140,200L 150,200L 160,200L 170,200L 180,200L 190,200L 200,200L 210,200L 220,200L 230,200L 240,200L 250,200L 260,200L 270,200L 280,200L 290,200L 295,200 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" fill="none" />
  <path fill="none" stroke="green" stroke-width="2" d="M 5,248 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0L 5,224Q 5,216 10,216Q 10,216 20,216L 30,216L 40,216L 50,216L 60,216L 70,216L 80,216L 90,216L 100,216L 110,216L 120,216L 130,216L 140,216L 150,216L 160,216L 170,216L 180,216L 190,216L 200,216L 210,216L 220,216L 230,216L 240,216L 250,216L 260,216L 270,216" />
  <text font-size="16" font-family="Menlo" dominant-baseline="middle" x="0" text-anchor="start" xml:space="preserve" y="8" fill="black">US    BANK    DEALERSHIP    GARAGE</text>
  <text dominant-baseline="middle" xml:space="preserve" font-size="16" text-anchor="start" font-family="Menlo" fill="black" y="56" x="20">money</text>
  <text text-anchor="start" xml:space="preserve" fill="black" x="190" y="104" font-family="Menlo" font-size="16" dominant-baseline="middle"></text>
  <text x="20" y="152" font-size="16" font-family="Menlo" dominant-baseline="middle" xml:space="preserve" fill="black" text-anchor="start">my_new_car</text>
  <text xml:space="preserve" x="310" y="200" fill="black" dominant-baseline="middle" font-size="16" font-family="Menlo" text-anchor="start"></text>
  <text text-anchor="start" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" fill="black" y="248" font-size="16" x="90">my_car</text>
  <text fill="black" y="264" xml:space="preserve" text-anchor="start" id="car" font-family="Menlo" font-size="64" dominant-baseline="middle" x="0"></text>
</svg>
<div class="fragment">
<p>...reflection time...</p>
</div>
</section><section id="ownership-is-intuitive-5" class="slide level2 center">
<h2>Ownership is intuitive?</h2>
</section><section id="correction-ownership-is-intuitive-except-for-programmers-..." class="slide level2 center">
<h2>Correction: Ownership is intuitive, except for programmers ...</h2>
<p>(copying data like integers, and characters, and .mp3's, is &quot;free&quot;)</p>
<div class="fragment">
<h3 id="and-anyone-else-who-names-things">... and anyone else who <em>names</em> things</h3>
</div>
</section><section id="ber-sinn-und-bedeutung" class="slide level2">
<h2>ber Sinn und Bedeutung</h2>
<p>(&quot;On sense and reference&quot; -- Gottlob Frege, 1892)</p>
<p>If ownership were all we had, car-purchase slide seems nonsensical</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust">my_new_car.drive_to(home);</code></pre></div>
<div class="fragment">
<p>Does this transfer <code>home</code> into the car?</p>
<p>Do I lose access to my home, just because I drive to it?</p>
</div>
<div class="fragment">
<p>We must distinguish an object itself from ways to name that object</p>
<ul>
<li><p>Above, <code>home</code> cannot be (an owned) <code>Home</code></p></li>
<li><p><code>home</code> must instead be some kind of <em>reference</em> to a <code>Home</code></p></li>
</ul>
</div>
</section><section id="so-we-will-need-references" class="slide level2 center">
<h2>So we will need references</h2>
<blockquote>
<p>We can solve any problem by introducing an extra level of indirection</p>
</blockquote>
<p>-- David J. Wheeler</p>
</section><section id="a-truth-ownership-is-important" class="slide level2 center">
<h2>a truth: Ownership <em>is</em> important</h2>
</section><section id="ownership-is-important" class="slide level2">
<h2>Ownership is important</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Ownership enables:</th>
<th style="text-align: left;">which removes:</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RAII-style destructors</td>
<td style="text-align: left;">a source of memory leaks (or fd leaks, etc)</td>
</tr>
<tr class="even">
<td style="text-align: left;">no dangling pointers</td>
<td style="text-align: left;">many resource management bugs</td>
</tr>
<tr class="odd">
<td style="text-align: left;">no data races</td>
<td style="text-align: left;">many multithreading heisenbugs</td>
</tr>
</tbody>
</table>
<div class="fragment">
<blockquote>
<p>Do I need to take ownership here, accepting the associated resource management responsibility? Would temporary access suffice?</p>
</blockquote>
</div>
<div class="fragment">
<p>Good developers ask this already!</p>
<p>Rust forces function signatures to encode the answers</p>
<p>(and they are checked by the compiler)</p>
<aside class="notes">
<p>Its worth pointing out that the encoded answer can include &quot;I leave it up to the caller to decide&quot;; that is what <code>Cow&lt;'a, T&gt;</code> is for.</p>
</aside>
</div>
</section></section>
<section><section id="sharing-data-ownership-and-references" class="titleslide slide level1 center"><h1>Sharing Data: Ownership and References</h1></section><section id="rust-types" class="slide level2">
<h2>Rust types</h2>
<h4 id="generic-types-bounded-polymorphism">Generic Types, Bounded Polymorphism</h4>
<!--
```rust
use std::ops::Add;
```
-->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> choose&lt;T&gt;(x: T, y: T) -&gt; T <span class="op">{</span> <span class="kw">return</span> x; <span class="op">}</span>

<span class="kw">fn</span> sum&lt;T: Add&gt;(x: T, y: T) -&gt; T::Output <span class="op">{</span> <span class="kw">return</span> x + y; <span class="op">}</span>

<span class="kw">fn</span> sum3&lt;T&gt;(x: T, y: T, z: T) -&gt; T <span class="kw">where</span> T: Add&lt;Output=T&gt; <span class="op">{</span> <span class="kw">return</span> x + y + z; <span class="op">}</span></code></pre></div>
<div class="fragment">
<p>Type Constructions</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Move</th>
<th style="text-align: left;">Copy</th>
<th style="text-align: left;">Copy if <code>T:Copy</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Vec&lt;T&gt;</code>, <code>String</code>, ...</td>
<td style="text-align: left;"><code>i32</code>, <code>char</code>, ...</td>
<td style="text-align: left;"><code>[T; n]</code>, <code>(T1,T2,T3)</code>, ...</td>
</tr>
</tbody>
</table>
</div>
<div class="fragment">
<p>References to data</p>
<ul>
<li><p><code>&amp;mut T</code>, <code>&amp;T</code></p></li>
<li><p>(plus library reference types: <code>Box&lt;T&gt;</code>, <code>Cow&lt;T&gt;</code>, <code>Rc&lt;T&gt;</code>, ...)</p></li>
</ul>
</div>
</section><section id="why-multiple--reference-types" class="slide level2 center">
<h2>Why multiple <code>&amp;</code>-reference types?</h2>
<ul>
<li><p>Distinguish <em>exclusive</em> access from <em>shared</em> access</p></li>
<li><p>Enables <strong>safe</strong>, <strong>parallel</strong> API's</p></li>
</ul>
<div class="fragment">
<table>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ownership</td>
<td style="text-align: left;"><code>T</code></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">Exclusive access</td>
<td style="text-align: left;"><code>&amp;mut T</code></td>
<td>(&quot;mutable&quot;)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shared access</td>
<td style="text-align: left;"><code>&amp;T</code></td>
<td>(&quot;read-only&quot;)</td>
</tr>
</tbody>
</table>
</div>
</section></section>
<section><section id="a-metaphor" class="titleslide slide level1 center"><h1>A Metaphor</h1></section><section id="mut-can-i-borrow-the-car" class="slide level2">
<h2><code>&amp;mut</code>: can I borrow the car?</h2>
<aside class="notes">
<p>If I own a car, and I lend the keys to Arnie, I <em>still</em> own the car</p>
</aside>
<!--
```rust
use std::rc::Rc;
use std::cell::RefCell;
struct Car { color: Color, engine: Engine }
struct Arnie<GF=NoGirlfriend> { fav_color: Color, partner: GF }
struct NoGirlfriend;
struct Leigh<'a> { car: RefCell<Option<&'a mut Car>> }
trait Partner<'a> {
    fn lend(&self, c: &mut Car) { }
    fn take(&'a self, c: &'a mut Car) { }
}
impl<'a> Partner<'a> for NoGirlfriend { }
impl<'a> Partner<'a> for Leigh<'a> {
    fn take(&'a self, c: &'a mut Car) {
        *self.car.borrow_mut() = Some(c);
    }
}
impl Arnie {
    fn lend(&self, c: &mut Car) { lend_1(self, c); lend_2(self, c); }
}
fn lend_1(arnie: &Arnie, k: &mut Car) { k.color = arnie.fav_color; }
fn lend_2(arnie: &Arnie, k: &mut Car) {
    arnie.partner.lend(k); k.color = arnie.fav_color;
}
fn invite_friend_over() -> Arnie {
    Arnie { fav_color: Color::Black, partner: NoGirlfriend }
}
type Location = ();
static work: Location = ();
impl Car {
    fn new() -> Car { Car { color: Color::Red, engine: Engine::VintageV8 } }
    fn drive_to(&mut self, l: Location) { }
}
```
--->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> borrow_the_car_1() <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> christine = Car::new();
    <span class="op">{</span>
        <span class="kw">let</span> car_keys = &amp;<span class="kw">mut</span> christine;
        <span class="kw">let</span> arnie = invite_friend_over();
        arnie.lend(car_keys);
    <span class="op">}</span> <span class="co">// end of scope for `arnie` and `car_keys`</span>
    christine.drive_to(work); <span class="co">// I still own the car!</span>
<span class="op">}</span></code></pre></div>
<svg height="192" version="1.1" viewBox="0 0 370 192" width="370" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <path stroke="blue" d="M 45,48 Q 45,40 50,40Q 50,40 60,40L 70,40L 80,40L 90,40L 100,40Q 105,40 105,48L 105,64L 105,80L 105,96L 105,112L 105,128L 105,144Q 105,152 100,152Q 100,152 90,152L 80,152L 70,152L 60,152L 50,152Q 45,152 45,144L 45,128L 45,112L 45,96L 45,80L 45,72L 45,48 Z" stroke-width="2" id="scope" fill="none" />
  <path stroke-width="2" stroke="green" d="M 315,184 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3L 300,184L 290,184L 280,184L 270,184L 260,184L 250,184L 240,184L 230,184L 220,184L 210,184L 200,184L 190,184L 180,184L 170,184L 160,184L 150,184L 140,184L 130,184L 120,184L 110,184L 100,184L 90,184L 80,184L 70,184L 60,184L 50,184L 40,184L 30,184L 20,184L 10,184Q 5,184 5,176L 5,160L 5,144L 5,128L 5,112L 5,96L 5,80L 5,64L 5,48L 5,32L 5,16Q 5,8 10,8Q 10,8 20,8" fill="none" />
  <path stroke="green" stroke-dasharray="5,2" d="M 25,24 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 25,48L 25,64Q 25,72 30,72Q 30,72 40,72L 45,72L 60,72" stroke-width="2" fill="none" />
  <text dominant-baseline="middle" xml:space="preserve" font-size="16" fill="black" x="20" font-family="Menlo" text-anchor="start" y="8"></text>
  <text fill="black" dominant-baseline="middle" x="110" text-anchor="start" xml:space="preserve" y="40" font-size="16" font-family="Menlo">(scope of arnie)</text>
  <text font-family="Menlo" fill="black" xml:space="preserve" y="72" dominant-baseline="middle" x="60" text-anchor="start" font-size="16">   </text>
  <text fill="black" x="330" font-size="16" xml:space="preserve" dominant-baseline="middle" y="184" font-family="Menlo" text-anchor="start">WORK</text>
</svg>
</section><section class="slide level2">

<p>But when her keys are elsewhere, I cannot drive <code>christine</code>!</p>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">fn</span> borrow_the_car_2() <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> christine = Car::new();
    <span class="op">{</span>
        <span class="kw">let</span> car_keys = &amp;<span class="kw">mut</span> christine;
        <span class="kw">let</span> arnie = invite_friend_over();
        arnie.lend(car_keys);
        christine.drive_to(work); <span class="co">// &lt;-- compile error</span>
    <span class="op">}</span> <span class="co">// end of scope for `arnie` and `car_keys`</span>
<span class="op">}</span></code></pre></div>
<svg height="176" baseProfile="full" xmlns="http://www.w3.org/2000/svg" version="1.1" width="380" viewBox="0 0 380 176">
  <path id="scope" stroke="blue" d="M 45,64 Q 45,56 50,56Q 50,56 60,56L 70,56L 80,56L 90,56L 100,56Q 105,56 105,64L 105,80L 105,96L 105,112L 105,128L 105,144L 105,160Q 105,168 100,168Q 100,168 90,168L 80,168L 70,168L 60,168L 50,168Q 45,168 45,160L 45,144L 45,128L 45,112L 45,96L 45,88L 45,64 Z" fill="none" stroke-width="2" />
  <path stroke-width="2" fill="none" stroke="red" d="M 40,136 L 30,136L 20,136L 10,136Q 5,136 5,128L 5,112L 5,96L 5,80L 5,64L 5,48L 5,32L 5,16Q 5,8 10,8Q 10,8 20,8" id="a" />
  <path fill="none" stroke-dasharray="5,2" id="ref" stroke="green" stroke-width="2" d="M 25,24 l 0,-5 m -3,5 l 3,-5 l 3, 5 m -3,0L 25,48L 25,64L 25,80Q 25,88 30,88Q 30,88 40,88L 45,88L 60,88" />
  <path stroke="red" stroke-width="2" d="M 50,136 L 60,136L 70,136L 80,136L 90,136L 100,136" id="b" fill="none" />
  <path stroke-width="2" d="M 110,136 L 120,136L 130,136L 140,136L 150,136L 160,136L 170,136L 180,136L 190,136L 200,136L 210,136L 220,136L 230,136L 240,136L 250,136L 260,136L 270,136L 280,136L 290,136L 300,136L 310,136L 320,136L 325,136 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="red" fill="none" id="c" />
  <text text-anchor="start" xml:space="preserve" fill="black" x="20" y="8" dominant-baseline="middle" font-size="16" font-family="Menlo"></text>
  <text xml:space="preserve" dominant-baseline="middle" fill="black" font-size="16" text-anchor="start" y="56" font-family="Menlo" x="110">(scope of arnie)</text>
  <text y="88" fill="black" xml:space="preserve" dominant-baseline="middle" font-size="16" font-family="Menlo" x="60" text-anchor="start">   </text>
  <text x="340" y="136" font-size="16" text-anchor="start" font-family="Menlo" fill="black" xml:space="preserve" dominant-baseline="middle">WORK</text>
</svg>
<div class="fragment">
<p>Owner loses capabilities attached to <code>&amp;mut</code>-borrows only <em>temporarily</em> (*)</p>
<aside class="notes">
<p>Keys <em>will</em> return after <code>&amp;mut</code>-borrow ends; I, the owner, will regain exclusive access (and the ability to lend out the keys again, or transfer ownership elsewhere, or even destroy Christine).</p>
</aside>
<p>(*): &quot;Car keys&quot; return guaranteed by Rust; sadly, not by physical world</p>
</div>
</section><section id="slices-borrowing-parts-of-an-array" class="slide level2 center">
<h2>Slices: borrowing <em>parts</em> of an array</h2>
</section><section id="basic-vecb" class="slide level2">
<h2>Basic <code>Vec&lt;B&gt;</code></h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> <span class="kw">mut</span> a = <span class="dt">Vec</span>::new();
<span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0.</span>.n <span class="op">{</span> a.push(B::new()); <span class="op">}</span></code></pre></div>
<svg baseProfile="full" width="340" viewBox="0 0 340 256" xmlns="http://www.w3.org/2000/svg" version="1.1" height="256">
  <path stroke="green" d="M 195,64 Q 195,56 200,56Q 200,56 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56Q 335,56 335,64L 335,80L 335,96L 335,112L 335,128L 335,144L 335,160L 335,176L 335,192L 335,208L 335,224L 335,240Q 335,248 330,248Q 330,248 320,248L 310,248L 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248Q 195,248 195,240L 195,224L 195,208L 195,192L 195,176L 195,160L 195,144L 195,128L 195,112L 195,96L 195,80L 195,64 Z" fill="none" stroke-width="2" />
  <path d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8L 190,8L 200,8Q 205,8 205,16L 205,32L 205,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" fill="none" stroke-width="2" stroke="green" />
  <text dominant-baseline="middle" fill="black" xml:space="preserve" font-family="Menlo" text-anchor="start" x="30" y="8" font-size="16">a </text>
  <text x="220" dominant-baseline="middle" text-anchor="start" font-size="16" xml:space="preserve" fill="black" font-family="Menlo" y="24">rw</text>
  <text x="240" fill="black" xml:space="preserve" text-anchor="start" y="72" font-size="16" dominant-baseline="middle" font-family="Menlo">B_1      </text>
  <text font-family="Menlo" fill="black" x="240" dominant-baseline="middle" y="104" font-size="16" xml:space="preserve" text-anchor="start">B_2      </text>
  <text dominant-baseline="middle" fill="black" y="136" text-anchor="start" font-size="16" font-family="Menlo" xml:space="preserve" x="240">B_3      </text>
  <text xml:space="preserve" dominant-baseline="middle" x="230" fill="black" font-size="16" text-anchor="start" y="184" font-family="Menlo">. . .     </text>
  <text y="232" font-size="16" text-anchor="start" font-family="Menlo" x="240" xml:space="preserve" fill="black" dominant-baseline="middle">B_n      </text>
</svg>
<p>(<code>a</code> has read and write capabilities)</p>
</section><section id="immutable-borrowed-slices-t" class="slide level2">
<h2>Immutable borrowed slices: <code>&amp;[T]</code></h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> <span class="kw">mut</span> a = <span class="dt">Vec</span>::new();
<span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0.</span>.n <span class="op">{</span> a.push(B::new()); <span class="op">}</span>
<span class="kw">let</span> r1 = &amp;a<span class="op">[</span><span class="dv">0.</span>.<span class="dv">3</span><span class="op">]</span>;
<span class="kw">let</span> r2 = &amp;a<span class="op">[</span><span class="dv">7.</span>.n-<span class="dv">4</span><span class="op">]</span>;</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" width="320" viewBox="0 0 320 256" baseProfile="full" height="256" version="1.1">
  <path d="M 175,64 Q 175,56 180,56Q 180,56 190,56L 200,56L 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56Q 315,56 315,64L 315,80L 315,96L 315,112L 315,128L 315,144L 315,160L 315,176L 315,192L 315,208L 315,224L 315,240Q 315,248 310,248Q 310,248 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248L 190,248L 180,248Q 175,248 175,240L 175,224L 175,208L 175,192L 175,176L 175,160L 175,144L 175,128L 175,112L 175,96L 175,80L 175,64 Z" stroke="green" fill="none" stroke-width="2" />
  <path stroke="green" stroke-width="2" fill="none" d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8Q 185,8 185,16L 185,32L 185,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" />
  <path d="M 140,72 L 150,72 L 145,72L 145,96L 145,112L 145,128L 145,152 L 140,152 L 150,152" stroke-width="2" fill="none" stroke="green" />
  <path stroke-width="2" stroke-dasharray="5,2" d="M 60,88 L 70,88L 80,88L 90,88L 100,88L 110,88L 120,88L 130,88L 135,88 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" fill="none" />
  <path stroke-width="2" d="M 140,184 L 150,184 L 145,184L 145,216 L 140,216 L 150,216" stroke="green" fill="none" />
  <path d="M 60,200 L 70,200L 80,200L 90,200L 100,200L 110,200L 120,200L 130,200L 135,200 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-dasharray="5,2" stroke="green" stroke-width="2" fill="none" />
  <text xml:space="preserve" font-family="Menlo" y="8" text-anchor="start" fill="black" font-size="16" dominant-baseline="middle" x="30">a </text>
  <text fill="black" font-size="16" text-anchor="start" y="24" xml:space="preserve" dominant-baseline="middle" x="200" font-family="Menlo">r</text>
  <text fill="black" y="72" font-family="Menlo" font-size="16" dominant-baseline="middle" text-anchor="start" xml:space="preserve" x="120">r </text>
  <text fill="black" y="72" xml:space="preserve" font-family="Menlo" dominant-baseline="middle" text-anchor="start" font-size="16" x="220">B_1      </text>
  <text xml:space="preserve" dominant-baseline="middle" font-size="16" text-anchor="start" fill="black" x="30" y="88" font-family="Menlo">r1 </text>
  <text text-anchor="start" x="220" font-family="Menlo" xml:space="preserve" dominant-baseline="middle" font-size="16" fill="black" y="104">B_2      </text>
  <text y="136" text-anchor="start" dominant-baseline="middle" font-family="Menlo" xml:space="preserve" font-size="16" x="220" fill="black">B_3      </text>
  <text text-anchor="start" dominant-baseline="middle" font-family="Menlo" fill="black" font-size="16" y="184" xml:space="preserve" x="120">r </text>
  <text font-size="16" text-anchor="start" dominant-baseline="middle" y="184" font-family="Menlo" x="210" fill="black" xml:space="preserve">. . .     </text>
  <text xml:space="preserve" fill="black" dominant-baseline="middle" font-size="16" y="200" text-anchor="start" x="30" font-family="Menlo">r2 </text>
  <text y="232" xml:space="preserve" x="220" font-size="16" text-anchor="start" font-family="Menlo" fill="black" dominant-baseline="middle">B_n      </text>
</svg>
<p>(<code>a</code> has only read capability now; shares it with <code>r1</code> and <code>r2</code>)</p>
</section><section id="safe-overlap-between-.." class="slide level2">
<h2>Safe overlap between <code>&amp;[..]</code></h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> <span class="kw">mut</span> a = <span class="dt">Vec</span>::new();
<span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0.</span>.n <span class="op">{</span> a.push(B::new()); <span class="op">}</span>
<span class="kw">let</span> r1 = &amp;a<span class="op">[</span><span class="dv">0.</span>.<span class="dv">7</span><span class="op">]</span>;
<span class="kw">let</span> r2 = &amp;a<span class="op">[</span><span class="dv">3.</span>.n-<span class="dv">4</span><span class="op">]</span>;</code></pre></div>
<svg width="320" viewBox="0 0 320 256" baseProfile="full" height="256" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="green" stroke-width="2" d="M 175,64 Q 175,56 180,56Q 180,56 190,56L 200,56L 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56Q 315,56 315,64L 315,80L 315,96L 315,112L 315,128L 315,144L 315,160L 315,176L 315,192L 315,208L 315,224L 315,240Q 315,248 310,248Q 310,248 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248L 190,248L 180,248Q 175,248 175,240L 175,224L 175,208L 175,192L 175,176L 175,160L 175,144L 175,128L 175,112L 175,96L 175,80L 175,64 Z" />
  <path stroke="green" fill="none" d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8Q 185,8 185,16L 185,32L 185,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" stroke-width="2" />
  <path d="M 110,72 L 120,72 L 115,72L 115,96L 115,112L 115,128L 115,144L 115,168 L 110,168 L 120,168" stroke-width="2" stroke="green" fill="none" />
  <path fill="none" stroke="green" stroke-width="2" stroke-dasharray="5,2" d="M 60,88 L 70,88L 80,88L 90,88L 100,88L 105,88 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path stroke-width="2" fill="none" stroke="green" d="M 150,136 L 160,136 L 155,136L 155,160L 155,176L 155,192L 155,216 L 150,216 L 160,216" />
  <path stroke="green" stroke-width="2" fill="none" d="M 60,200 L 70,200L 80,200L 90,200L 100,200L 110,200L 120,200L 130,200L 140,200L 145,200 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-dasharray="5,2" />
  <text xml:space="preserve" dominant-baseline="middle" text-anchor="start" x="30" font-family="Menlo" font-size="16" y="8" fill="black">a </text>
  <text text-anchor="start" font-family="Menlo" font-size="16" y="24" x="200" dominant-baseline="middle" fill="black" xml:space="preserve">r</text>
  <text font-size="16" font-family="Menlo" x="90" text-anchor="start" dominant-baseline="middle" fill="black" y="72" xml:space="preserve">r </text>
  <text font-size="16" text-anchor="start" dominant-baseline="middle" fill="black" y="72" xml:space="preserve" font-family="Menlo" x="220">B_1      </text>
  <text x="30" font-size="16" font-family="Menlo" xml:space="preserve" y="88" text-anchor="start" fill="black" dominant-baseline="middle">r1 </text>
  <text y="104" font-family="Menlo" dominant-baseline="middle" fill="black" xml:space="preserve" font-size="16" text-anchor="start" x="220">B_2      </text>
  <text dominant-baseline="middle" font-size="16" x="220" y="136" text-anchor="start" xml:space="preserve" fill="black" font-family="Menlo">B_3      </text>
  <text fill="black" x="130" font-family="Menlo" dominant-baseline="middle" font-size="16" text-anchor="start" y="184" xml:space="preserve">r </text>
  <text font-size="16" fill="black" font-family="Menlo" text-anchor="start" x="210" dominant-baseline="middle" xml:space="preserve" y="184">. . .     </text>
  <text x="30" xml:space="preserve" dominant-baseline="middle" fill="black" y="200" text-anchor="start" font-size="16" font-family="Menlo">r2 </text>
  <text xml:space="preserve" y="232" x="220" font-family="Menlo" text-anchor="start" fill="black" dominant-baseline="middle" font-size="16">B_n      </text>
</svg>
</section><section id="basic-vecb-again" class="slide level2">
<h2>Basic <code>Vec&lt;B&gt;</code> again</h2>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" baseProfile="full" height="256" viewBox="0 0 340 256" width="340">
  <path stroke-width="2" d="M 195,64 Q 195,56 200,56Q 200,56 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56Q 335,56 335,64L 335,80L 335,96L 335,112L 335,128L 335,144L 335,160L 335,176L 335,192L 335,208L 335,224L 335,240Q 335,248 330,248Q 330,248 320,248L 310,248L 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248Q 195,248 195,240L 195,224L 195,208L 195,192L 195,176L 195,160L 195,144L 195,128L 195,112L 195,96L 195,80L 195,64 Z" fill="none" stroke="green" />
  <path fill="none" stroke-width="2" stroke="green" d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8L 190,8L 200,8Q 205,8 205,16L 205,32L 205,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" />
  <text xml:space="preserve" font-family="Menlo" y="8" text-anchor="start" font-size="16" dominant-baseline="middle" x="30" fill="black">a </text>
  <text font-family="Menlo" xml:space="preserve" fill="black" x="220" font-size="16" dominant-baseline="middle" text-anchor="start" y="24">rw</text>
  <text font-size="16" fill="black" x="240" y="72" dominant-baseline="middle" font-family="Menlo" text-anchor="start" xml:space="preserve">B_1      </text>
  <text fill="black" text-anchor="start" font-size="16" y="104" xml:space="preserve" x="240" font-family="Menlo" dominant-baseline="middle">B_2      </text>
  <text dominant-baseline="middle" x="240" y="136" xml:space="preserve" font-size="16" fill="black" font-family="Menlo" text-anchor="start">B_3      </text>
  <text font-family="Menlo" y="184" text-anchor="start" xml:space="preserve" fill="black" x="230" dominant-baseline="middle" font-size="16">. . .     </text>
  <text dominant-baseline="middle" x="240" text-anchor="start" xml:space="preserve" font-family="Menlo" fill="black" y="232" font-size="16">B_n      </text>
</svg>
<p>(<code>a</code> has read and write capabilities)</p>
</section><section id="mutable-slice-mut-t" class="slide level2">
<h2>Mutable slice: <code>&amp;mut [T]</code></h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> w = &amp;<span class="kw">mut</span> a<span class="op">[</span><span class="dv">0.</span>.n<span class="op">]</span>;</code></pre></div>
<svg version="1.1" width="340" height="256" baseProfile="full" viewBox="0 0 340 256" xmlns="http://www.w3.org/2000/svg">
  <path stroke-width="2" fill="none" d="M 195,64 Q 195,56 200,56Q 200,56 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56Q 335,56 335,64L 335,80L 335,96L 335,112L 335,128L 335,144L 335,160L 335,176L 335,192L 335,208L 335,224L 335,240Q 335,248 330,248Q 330,248 320,248L 310,248L 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248Q 195,248 195,240L 195,224L 195,208L 195,192L 195,176L 195,160L 195,144L 195,128L 195,112L 195,96L 195,80L 195,64 Z" stroke="green" />
  <path stroke="green" fill="none" stroke-width="2" d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8L 190,8L 200,8Q 205,8 205,16L 205,32L 205,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" />
  <path stroke-width="2" d="M 120,56 L 130,56 L 125,56L 125,80L 125,96L 125,112L 125,128L 125,144L 125,160L 125,176L 125,192L 125,208L 125,224L 125,248 L 120,248 L 130,248" stroke="green" fill="none" />
  <path stroke-dasharray="5,2" stroke-width="2" fill="none" d="M 50,72 L 60,72L 70,72L 80,72L 90,72L 100,72L 110,72L 115,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" />
  <text font-size="16" y="8" font-family="Menlo" fill="black" text-anchor="start" xml:space="preserve" dominant-baseline="middle" x="30">a </text>
  <text font-family="Menlo" font-size="16" text-anchor="start" y="56" fill="black" x="90" dominant-baseline="middle" xml:space="preserve">rw </text>
  <text font-family="Menlo" dominant-baseline="middle" y="72" text-anchor="start" font-size="16" xml:space="preserve" x="30" fill="black">w </text>
  <text y="72" fill="black" xml:space="preserve" font-family="Menlo" font-size="16" x="240" text-anchor="start" dominant-baseline="middle">B_1      </text>
  <text x="240" fill="black" font-family="Menlo" xml:space="preserve" y="104" dominant-baseline="middle" font-size="16" text-anchor="start">B_2      </text>
  <text fill="black" font-family="Menlo" dominant-baseline="middle" y="136" xml:space="preserve" font-size="16" x="240" text-anchor="start">B_3      </text>
  <text font-size="16" text-anchor="start" xml:space="preserve" y="184" x="230" fill="black" dominant-baseline="middle" font-family="Menlo">. . .     </text>
  <text font-family="Menlo" y="232" xml:space="preserve" text-anchor="start" fill="black" font-size="16" x="240" dominant-baseline="middle">B_n      </text>
</svg>
<p>(<code>a</code> has <em>no</em> capabilities; <code>w</code> now has read and write capability)</p>
</section><section id="mutable-disjoint-slices" class="slide level2">
<h2>Mutable disjoint slices</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> (w1,w2) = a.split_at_mut(n-<span class="dv">4</span>);</code></pre></div>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 340 256" baseProfile="full" width="340" version="1.1" height="256">
  <path stroke="green" d="M 195,64 Q 195,56 200,56Q 200,56 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56Q 335,56 335,64L 335,80L 335,96L 335,112L 335,128L 335,144L 335,160L 335,176L 335,192L 335,208L 335,224L 335,240Q 335,248 330,248Q 330,248 320,248L 310,248L 300,248L 290,248L 280,248L 270,248L 260,248L 250,248L 240,248L 230,248L 220,248L 210,248L 200,248Q 195,248 195,240L 195,224L 195,208L 195,192L 195,176L 195,160L 195,144L 195,128L 195,112L 195,96L 195,80L 195,64 Z" fill="none" stroke-width="2" />
  <path fill="none" stroke="green" d="M 50,8 L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 150,8L 160,8L 170,8L 180,8L 190,8L 200,8Q 205,8 205,16L 205,32L 205,40 l 0,5 m -3,-5 l 3, 5 l 3,-5 m -3,0" stroke-width="2" />
  <path fill="none" d="M 120,56 L 130,56 L 125,56L 125,80L 125,96L 125,112L 125,128L 125,144L 125,160L 125,184 L 120,184 L 130,184" stroke="green" stroke-width="2" />
  <path fill="none" stroke-dasharray="5,2" d="M 60,72 L 70,72L 80,72L 90,72L 100,72L 110,72L 115,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" stroke="green" />
  <path stroke-width="2" fill="none" stroke="green" d="M 120,200 L 130,200 L 125,200L 125,224L 125,248 L 120,248 L 130,248" />
  <path fill="none" d="M 60,216 L 70,216L 80,216L 90,216L 100,216L 110,216L 115,216 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" stroke-dasharray="5,2" stroke="green" />
  <text font-family="Menlo" dominant-baseline="middle" xml:space="preserve" font-size="16" x="30" text-anchor="start" fill="black" y="8">a </text>
  <text font-family="Menlo" xml:space="preserve" font-size="16" y="56" text-anchor="start" fill="black" dominant-baseline="middle" x="90">rw </text>
  <text font-family="Menlo" font-size="16" x="30" dominant-baseline="middle" fill="black" text-anchor="start" y="72" xml:space="preserve">w1 </text>
  <text y="72" text-anchor="start" font-size="16" font-family="Menlo" dominant-baseline="middle" fill="black" xml:space="preserve" x="240">B_1      </text>
  <text text-anchor="start" x="240" dominant-baseline="middle" xml:space="preserve" y="104" fill="black" font-size="16" font-family="Menlo">B_2      </text>
  <text dominant-baseline="middle" y="136" font-family="Menlo" font-size="16" xml:space="preserve" x="240" fill="black" text-anchor="start">B_3      </text>
  <text font-size="16" y="200" font-family="Menlo" dominant-baseline="middle" x="90" xml:space="preserve" fill="black" text-anchor="start">rw </text>
  <text xml:space="preserve" font-family="Menlo" fill="black" dominant-baseline="middle" y="216" x="30" font-size="16" text-anchor="start">w2 </text>
  <text y="232" fill="black" font-family="Menlo" xml:space="preserve" dominant-baseline="middle" font-size="16" text-anchor="start" x="240">B_n      </text>
</svg>
<p>(<code>w1</code> and <code>w2</code> share read and write capabilities for disjoint portions)</p>
</section><section id="shared-ownership" class="slide level2 center">
<h2>Shared <em>Ownership</em></h2>
</section><section id="shared-ownership-1" class="slide level2">
<h2>Shared Ownership</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">let</span> rc1 = Rc::new(B::new());
<span class="kw">let</span> rc2 = rc1.clone(); <span class="co">// increments ref-count on heap-alloc&#39;d value</span></code></pre></div>
<svg baseProfile="full" version="1.1" xmlns="http://www.w3.org/2000/svg" height="192" width="310" viewBox="0 0 310 192">
  <path fill="none" d="M 215,32 Q 215,24 220,24Q 220,24 230,24L 240,24L 250,24L 260,24L 270,24L 280,24L 290,24L 300,24Q 305,24 305,32L 305,48L 305,56L 290,56L 280,56L 270,56L 260,56L 250,56L 240,56L 230,56L 220,56L 215,56L 215,32 Z" stroke-width="2" stroke="green" />
  <path stroke-width="2" d="M 5,144 L 5,128L 5,112L 5,96L 5,80L 5,64L 5,48L 5,32L 5,16L 5,8L 20,8L 30,8L 40,8L 50,8L 60,8L 70,8L 80,8L 90,8L 100,8L 110,8L 120,8L 130,8L 140,8L 145,8L 145,32" stroke="green" fill="none" />
  <path stroke-dasharray="5,2" stroke-width="2" d="M 80,40 L 90,40L 100,40L 110,40L 120,40L 130,40L 140,40L 150,40L 160,40L 170,40L 180,40L 185,40L 200,40L 205,40 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" stroke="green" />
  <path stroke-dasharray="5,2" d="M 185,40L 185,64Q 185,72 180,72Q 180,72 170,72L 160,72L 150,72L 140,72L 130,72L 120,72L 110,72L 100,72L 90,72L 80,72" fill="none" stroke-width="2" stroke="green" />
  <path fill="none" stroke="green" stroke-width="2" d="M 215,56L 215,80L 215,96L 215,112Q 215,120 220,120Q 220,120 230,120L 240,120L 250,120L 260,120L 270,120L 280,120L 290,120L 300,120Q 305,120 305,112L 305,96L 305,80L 305,64L 305,56" />
  <path d="M 145,80 L 145,96L 145,112L 145,128L 145,144" stroke-width="2" fill="none" stroke="green" />
  <path fill="none" stroke="green" stroke-width="2" d="M 5,160 L 5,176L 5,184L 20,184L 30,184L 40,184L 50,184L 60,184L 70,184L 80,184L 90,184L 100,184L 110,184L 120,184L 130,184L 140,184L 145,184L 145,160" />
  <text text-anchor="start" font-family="Menlo" fill="black" xml:space="preserve" x="190" font-size="16" dominant-baseline="middle" y="24">r </text>
  <text dominant-baseline="middle" x="40" y="40" font-size="16" font-family="Menlo" text-anchor="start" fill="black" xml:space="preserve">rc1 </text>
  <text font-family="Menlo" fill="black" x="250" text-anchor="start" xml:space="preserve" y="40" dominant-baseline="middle" font-size="16">2    </text>
  <text fill="black" font-family="Menlo" dominant-baseline="middle" y="56" x="140" font-size="16" text-anchor="start" xml:space="preserve">|   </text>
  <text dominant-baseline="middle" y="72" font-size="16" font-family="Menlo" x="40" text-anchor="start" fill="black" xml:space="preserve">rc2 </text>
  <text fill="black" font-family="Menlo" x="250" text-anchor="start" dominant-baseline="middle" y="72" font-size="16" xml:space="preserve">B    </text>
  <text xml:space="preserve" font-size="16" font-family="Menlo" text-anchor="start" fill="black" x="50" dominant-baseline="middle" y="152">. . .</text>
</svg>
<p>(<code>rc1</code> and <code>rc2</code> each have read access; but neither can statically assume exclusive (<code>mut</code>) access, nor can they provide <code>&amp;mut</code> borrows without assistance.)</p>
</section></section>
<section><section id="sharing-work-parallelism-concurrency" class="titleslide slide level1 center"><h1>Sharing Work: Parallelism / Concurrency</h1></section><section id="threading-apis-plural" class="slide level2">
<h2>Threading APIs (plural!)</h2>
<ul>
<li><p><code>std::thread</code></p></li>
<li><p><code>crossbeam</code> : Lock-Free Abstractions, Scoped &quot;Must-be&quot; Concurrency</p></li>
<li><p><code>rayon</code> : Scoped Fork-join &quot;Maybe&quot; Parallelism (inspired by Cilk)</p></li>
</ul>
<p>(Only the <em>first</em> comes with Rust out of the box)</p>
</section><section id="stdthread" class="slide level2" data-transition="fade-out">
<h2>std::thread</h2>
<!--
```rust
fn messages() -> Vec<String> {
    let mut info: Vec<String> = Vec::new();
    for i in 0..10 {
        let even_or_odd = if i % 2 == 0 { "even" } else { "odd" };
        info.push(format!("{} is {}", i, even_or_odd));
    }
    info
}

#[test]
fn std_thread_demo() {
    let handles = spawn_them(messages());
    for h in handles { h.join(); }
}
use std;
use std::thread::JoinHandle;
```
-->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> spawn_them(messages: <span class="dt">Vec</span>&lt;<span class="dt">String</span>&gt;) -&gt; <span class="dt">Vec</span>&lt;JoinHandle&lt;<span class="dt">usize</span>&gt;&gt; <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> handles = <span class="dt">Vec</span>::new();
    <span class="kw">for</span> <span class="kw">mut</span> msg <span class="kw">in</span> messages <span class="op">{</span>
        handles.push(std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span>
            msg.push_str(<span class="st">&quot;, isn&#39;t that special?&quot;</span>);
            <span class="kw">return</span> msg.len();
        <span class="op">}</span>));
    <span class="op">}</span>
    <span class="kw">return</span> handles;
<span class="op">}</span></code></pre></div>
<svg version="1.1" height="208" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 560 208" width="560">
  <path fill="none" d="M 120,40 L 130,40L 140,40L 150,40L 160,40L 170,40L 180,40L 190,40L 200,40L 210,40L 220,40L 230,40L 240,40L 250,40L 260,40L 270,40L 280,40L 290,40L 300,40L 310,40L 320,40L 330,40L 340,40L 350,40L 360,40L 370,40L 380,40L 390,40L 400,40L 410,40L 420,40L 430,40L 440,40L 450,40L 460,40L 470,40L 480,40L 490,40L 495,40 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" stroke-width="2" />
  <path stroke="blue" id="t1" stroke-dasharray="5,2" stroke-width="2" d="M 505,32 L 505,48L 505,64L 505,80L 505,96L 505,112L 505,128L 505,144L 505,160L 505,176L 505,192L 505,208" fill="none" />
  <path fill="none" stroke="green" d="M 120,56 L 130,56L 140,56L 150,56L 160,56L 170,56L 180,56L 190,56L 200,56L 210,56L 220,56L 230,56L 240,56L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 320,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 395,56 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-width="2" />
  <path stroke-dasharray="5,2" stroke-width="2" id="t2" stroke="blue" fill="none" d="M 405,48 L 405,64L 405,80L 405,96L 405,112L 405,128L 405,144L 405,160L 405,176L 405,192L 405,208" />
  <path d="M 120,72 L 130,72L 140,72L 150,72L 160,72L 170,72L 180,72L 190,72L 200,72L 210,72L 220,72L 230,72L 240,72L 250,72L 260,72L 270,72L 280,72L 285,72 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" stroke-width="2" fill="none" />
  <path stroke="blue" d="M 295,64 L 295,80L 295,96L 295,112L 295,128L 295,144L 295,160L 295,163 A 2,2 0 1 0 295,173  A 2,2 0 0 0 295,163 A 2,2 0 1 0 295,173" stroke-dasharray="5,2" id="t3" fill="none" stroke-width="2" />
  <path stroke-width="2" stroke="green" d="M 120,104 L 130,104L 140,104L 150,104L 155,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" />
  <path d="M 165,96 L 165,112L 165,128L 165,144L 165,160L 165,168L 165,192L 165,208" fill="none" id="tn" stroke="blue" stroke-dasharray="5,2" stroke-width="2" />
  <path id="parent" stroke="blue" stroke-width="2" fill="none" stroke-dasharray="5,2" d="M 65,112 L 65,128L 65,144" />
  <path id="paren2" stroke-width="2" d="M 65,160 L 65,176L 65,192L 65,208" stroke-dasharray="5,2" fill="none" stroke="blue" />
  <path d="M 85,168 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 100,168L 110,168L 120,168L 130,168L 140,168L 150,168L 160,168L 165,168L 180,168L 190,168L 200,168L 210,168L 220,168L 230,168L 240,168L 250,168L 260,168L 270,168L 280,168" stroke="green" stroke-width="2" fill="none" />
  <text fill="black" font-size="16" xml:space="preserve" y="8" x="40" text-anchor="start" font-family="Menlo" dominant-baseline="middle">parent    threadN      thread3    thread2    thread1</text>
  <text y="40" text-anchor="start" font-size="16" font-family="Menlo" fill="black" x="40" dominant-baseline="middle" xml:space="preserve">[msg1,  </text>
  <text font-size="16" x="50" dominant-baseline="middle" y="56" font-family="Menlo" text-anchor="start" xml:space="preserve" fill="black">msg2,  </text>
  <text text-anchor="start" font-size="16" xml:space="preserve" y="72" dominant-baseline="middle" font-family="Menlo" fill="black" x="50">msg3,  </text>
  <text fill="black" text-anchor="start" font-size="16" xml:space="preserve" y="88" font-family="Menlo" x="60" dominant-baseline="middle">                      </text>
  <text dominant-baseline="middle" text-anchor="start" fill="black" font-family="Menlo" font-size="16" xml:space="preserve" y="104" x="50">msgN]  </text>
  <text fill="black" y="152" text-anchor="start" font-family="Menlo" xml:space="preserve" x="10" font-size="16" dominant-baseline="middle">handle3.join() </text>
</svg>
<ul>
<li class="fragment">Joining <code>JoinHandle&lt;T&gt;</code> returns value (<code>T</code>) from thread's closure (<code>|| { ... }</code>)</li>
</ul>
<ul>
<li class="fragment">Handles move like other values (can even be sent between threads)</li>
</ul>
<ul>
<li class="fragment">Compiler assumes nothing of extents (<code>threadK</code> may outlive <code>parent</code>)</li>
</ul>
</section><section id="what-if-sole-ownership-does-not-suffice" class="slide level2">
<h2>What if sole ownership does not suffice?</h2>
<p>Example: two threads both must read from one heap-allocated vector. That <code>Vec</code> must survive as long as the threads.</p>
</section><section id="one-approach-shared-ownership" class="slide level2">
<h2>One approach: shared ownership</h2>
<!--
```rust
use std::rc::Rc;
use std::sync::Arc;
```
-->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> demo_sharing() <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> v = <span class="dt">Vec</span>::new();
    v.push(<span class="st">&quot;Hello&quot;</span>); v.push(<span class="st">&quot; &quot;</span>); v.push(<span class="st">&quot;World!&quot;</span>);

    <span class="co">// transfer vector `v` to heap-allocated (and ref-counted) storage</span>
    <span class="kw">let</span> rc1 = Rc::new(v);
    <span class="kw">let</span> rc2 = rc1.clone(); <span class="co">// increments ref-count on heap-alloc&#39;d value</span>
<span class="op">}</span></code></pre></div>
<svg baseProfile="full" viewBox="0 0 420 256" version="1.1" xmlns="http://www.w3.org/2000/svg" width="420" height="256">
  <path d="M 215,48 Q 215,40 220,40Q 220,40 230,40L 240,40L 250,40L 260,40L 270,40L 280,40L 290,40L 300,40Q 305,40 305,48L 305,64L 305,72L 290,72L 280,72L 270,72L 260,72L 250,72L 240,72L 230,72L 220,72L 215,72L 215,48 Z" stroke="green" stroke-width="2" fill="none" />
  <path stroke="green" stroke-width="2" fill="none" d="M 5,208 L 5,192L 5,176L 5,160L 5,144L 5,128L 5,112L 5,96L 5,80L 5,64L 5,48L 5,32L 5,24L 20,24L 30,24L 40,24L 50,24L 60,24L 70,24L 80,24L 90,24L 100,24L 110,24L 120,24L 130,24L 140,24L 145,24L 145,48" />
  <path stroke="green" fill="none" stroke-width="2" d="M 80,56 L 90,56L 100,56L 110,56L 120,56L 130,56L 140,56L 150,56L 160,56L 170,56L 180,56L 185,56L 200,56L 205,56 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-dasharray="5,2" />
  <path stroke-dasharray="5,2" fill="none" stroke-width="2" d="M 185,56L 185,80L 185,96Q 185,104 180,104Q 180,104 170,104L 160,104L 150,104L 140,104L 130,104L 120,104L 110,104L 100,104L 90,104L 80,104" stroke="green" />
  <path stroke="green" fill="none" d="M 145,64 L 145,80L 145,96" stroke-width="2" />
  <path stroke="green" stroke-width="2" fill="none" d="M 215,72L 215,96L 215,112L 215,128L 215,144L 215,160L 215,176L 215,192Q 215,200 220,200Q 220,200 230,200L 240,200L 250,200L 260,200L 270,200L 280,200L 290,200L 300,200Q 305,200 305,192L 305,176L 305,168L 305,144L 305,136L 305,112L 305,104L 305,80L 305,72" />
  <path stroke="green" stroke-dasharray="5,2" stroke-width="2" d="M 260,104 L 270,104L 280,104L 290,104L 300,104L 305,104L 320,104L 325,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" />
  <path stroke="green" stroke-width="2" d="M 145,112 L 145,128L 145,144L 145,160L 145,176L 145,192L 145,208" fill="none" />
  <path stroke-width="2" stroke-dasharray="5,2" fill="none" stroke="green" d="M 260,136 L 270,136L 280,136L 290,136L 300,136L 305,136L 320,136L 325,136 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path fill="none" stroke="green" stroke-width="2" stroke-dasharray="5,2" d="M 260,168 L 270,168L 280,168L 290,168L 300,168L 305,168L 320,168L 325,168 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path stroke="green" stroke-width="2" fill="none" d="M 5,224 L 5,240L 5,248L 20,248L 30,248L 40,248L 50,248L 60,248L 70,248L 80,248L 90,248L 100,248L 110,248L 120,248L 130,248L 140,248L 145,248L 145,224" />
  <text font-family="Menlo" text-anchor="start" font-size="16" y="40" fill="black" x="190" xml:space="preserve" dominant-baseline="middle">r </text>
  <text xml:space="preserve" dominant-baseline="middle" y="56" font-family="Menlo" x="40" fill="black" text-anchor="start" font-size="16">rc1 </text>
  <text font-family="Menlo" x="250" font-size="16" xml:space="preserve" fill="black" y="56" dominant-baseline="middle" text-anchor="start">2    </text>
  <text font-family="Menlo" y="104" dominant-baseline="middle" font-size="16" text-anchor="start" xml:space="preserve" x="40" fill="black">rc2 </text>
  <text text-anchor="start" x="340" font-size="16" y="104" dominant-baseline="middle" xml:space="preserve" font-family="Menlo" fill="black">"Hello"</text>
  <text fill="black" text-anchor="start" font-size="16" dominant-baseline="middle" y="136" font-family="Menlo" x="340" xml:space="preserve">" "</text>
  <text xml:space="preserve" dominant-baseline="middle" fill="black" x="340" y="168" text-anchor="start" font-family="Menlo" font-size="16">"World!"</text>
  <text text-anchor="start" dominant-baseline="middle" fill="black" y="216" font-family="Menlo" x="50" xml:space="preserve" font-size="16">. . .</text>
</svg>
</section><section id="problem-solved" class="slide level2">
<h2>Problem solved?</h2>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">fn</span> failed_sharing_cross_threads() <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> v = <span class="dt">Vec</span>::new();
    v.push(<span class="st">&quot;Hello&quot;</span>); v.push(<span class="st">&quot; &quot;</span>); v.push(<span class="st">&quot;World!&quot;</span>);

    <span class="co">// transfer vector `v` to heap-allocated (and ref-counted) storage</span>
    <span class="kw">let</span> rc1 = Rc::new(v);
    <span class="kw">let</span> rc2 = rc1.clone(); <span class="co">// increments ref-count on heap-alloc&#39;d value</span>

    <span class="kw">let</span> h1 = std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span> rc1<span class="op">[</span><span class="dv">0</span><span class="op">]</span>.len() <span class="op">}</span>);
    <span class="kw">let</span> h2 = std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span> rc2<span class="op">[</span><span class="dv">2</span><span class="op">]</span>.len() <span class="op">}</span>);

    h1.join(); h2.join();
<span class="op">}</span></code></pre></div>
<div class="fragment">
<pre><code>error: the trait bound `Rc&lt;Vec&lt;&amp;str&gt;&gt;: Send` is not satisfied in `[closure]`
   --&gt; src/b01_concurrency_demos.rs:126:14
    |
126 |     let h1 = std::thread::spawn(move || { rc1[0].len() });
    |              ^^^^^^^^^^^^^^^^^^ within `[closure]`, the trait `Send` is
    |                                 not implemented for `Rc&lt;Vec&lt;&amp;str&gt;&gt;`
    |
    = note: `Rc&lt;Vec&lt;&amp;str&gt;&gt;` cannot be sent between threads safely
    = note: required because it appears within the type `[closure]`
    = note: required by `std::thread::spawn`</code></pre>
</div>
</section><section id="issue" class="slide level2">
<h2>Issue</h2>
<p><code>Rc&lt;T&gt;</code> uses <em>non-atomic</em> updates for ref-count maintenance</p>
<p>Easily fixed: if you need to share ownership across threads, then use <code>Arc&lt;T&gt;</code> instead.</p>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> demo_sharing_cross_threads() <span class="op">{</span>
    <span class="kw">let</span> <span class="kw">mut</span> v = <span class="dt">Vec</span>::new();
    v.push(<span class="st">&quot;Hello&quot;</span>); v.push(<span class="st">&quot; &quot;</span>); v.push(<span class="st">&quot;World!&quot;</span>);

    <span class="co">// transfer vector `v` to heap-allocated (and ref-counted) storage</span>
    <span class="kw">let</span> arc1 = Arc::new(v);
    <span class="kw">let</span> arc2 = arc1.clone(); <span class="co">// increments ref-count on heap-alloc&#39;d value</span>

    <span class="kw">let</span> h1 = std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span> arc1<span class="op">[</span><span class="dv">0</span><span class="op">]</span>.len() <span class="op">}</span>);
    <span class="kw">let</span> h2 = std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span> arc2<span class="op">[</span><span class="dv">2</span><span class="op">]</span>.len() <span class="op">}</span>);

    h1.join(); h2.join();
<span class="op">}</span></code></pre></div>
</section><section id="illustrating-arc" class="slide level2">
<h2>Illustrating <code>Arc</code></h2>
<svg viewBox="0 0 690 256" version="1.1" xmlns="http://www.w3.org/2000/svg" height="256" width="690" baseProfile="full">
  <path d="M 455,48 Q 455,40 460,40Q 460,40 470,40L 480,40L 490,40L 500,40L 510,40L 520,40L 530,40L 540,40L 550,40L 560,40L 570,40Q 575,40 575,48L 575,64L 575,72L 560,72L 550,72L 540,72L 530,72L 520,72L 510,72L 500,72L 490,72L 480,72L 470,72L 460,72L 455,72L 455,48 Z" stroke="green" stroke-width="2" fill="none" />
  <path stroke-width="2" stroke="green" fill="none" d="M 5,208 L 5,192L 5,176L 5,160L 5,144L 5,128L 5,112L 5,96L 5,80L 5,64L 5,48L 5,32L 5,24L 20,24L 30,24L 40,24L 50,24L 60,24L 70,24L 80,24L 90,24L 100,24L 110,24L 120,24L 130,24L 140,24L 145,24L 145,48" />
  <path d="M 205,16 L 205,32L 205,48" id="t1a" fill="none" stroke-width="2" stroke="blue" />
  <path stroke="blue" stroke-width="2" d="M 315,16 L 315,32L 315,48L 315,56L 315,80L 315,96" id="t2b" fill="none" />
  <path stroke="green" fill="none" stroke-width="2" d="M 100,56 L 110,56L 120,56L 130,56L 140,56L 150,56L 160,56L 170,56L 175,56 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path stroke-width="2" stroke-dasharray="5,2" fill="none" d="M 240,56 L 250,56L 260,56L 270,56L 280,56L 290,56L 300,56L 310,56L 315,56L 330,56L 340,56L 350,56L 360,56L 370,56L 380,56L 390,56L 400,56L 410,56L 420,56L 425,56L 440,56L 445,56 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke="green" />
  <path stroke-width="2" stroke="green" fill="none" d="M 425,56L 425,80L 425,96Q 425,104 420,104Q 420,104 410,104L 400,104L 390,104L 380,104L 370,104L 360,104" stroke-dasharray="5,2" />
  <path stroke-width="2" fill="none" stroke="green" d="M 145,64 L 145,80L 145,96" />
  <path fill="none" stroke="blue" d="M 205,64 L 205,80L 205,96L 205,104L 205,128L 205,144L 205,160L 205,176L 205,192L 205,208L 205,224L 205,240L 205,256" id="t1b" stroke-width="2" />
  <path d="M 455,72L 455,96L 455,112L 455,128L 455,144L 455,160L 455,176L 455,192Q 455,200 460,200Q 460,200 470,200L 480,200L 490,200L 500,200L 510,200L 520,200L 530,200L 540,200L 550,200L 560,200L 570,200Q 575,200 575,192L 575,176L 575,168L 575,144L 575,136L 575,112L 575,104L 575,80L 575,72" stroke="green" fill="none" stroke-width="2" />
  <path stroke="green" fill="none" stroke-width="2" d="M 100,104 L 110,104L 120,104L 130,104L 140,104L 150,104L 160,104L 170,104L 180,104L 190,104L 200,104L 205,104L 220,104L 230,104L 240,104L 250,104L 260,104L 270,104L 280,104L 290,104L 295,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" />
  <path d="M 500,104 L 510,104L 520,104L 530,104L 540,104L 550,104L 560,104L 570,104L 575,104L 590,104L 595,104 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-dasharray="5,2" fill="none" stroke="green" stroke-width="2" />
  <path fill="none" stroke-width="2" d="M 145,112 L 145,128L 145,144L 145,160L 145,176L 145,192L 145,208" stroke="green" />
  <path fill="none" stroke-width="2" id="t2b" d="M 315,112 L 315,128L 315,144L 315,160L 315,176L 315,192L 315,208L 315,224L 315,240L 315,256" stroke="blue" />
  <path d="M 500,136 L 510,136L 520,136L 530,136L 540,136L 550,136L 560,136L 570,136L 575,136L 590,136L 595,136 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" fill="none" stroke="green" stroke-dasharray="5,2" stroke-width="2" />
  <path stroke="green" fill="none" stroke-width="2" d="M 500,168 L 510,168L 520,168L 530,168L 540,168L 550,168L 560,168L 570,168L 575,168L 590,168L 595,168 l 3,0 m -3,-3 l 3,3 l -3,3 m 0,-3" stroke-dasharray="5,2" />
  <path fill="none" stroke-width="2" d="M 5,224 L 5,240L 5,248L 20,248L 30,248L 40,248L 50,248L 60,248L 70,248L 80,248L 90,248L 100,248L 110,248L 120,248L 130,248L 140,248L 145,248L 145,224" stroke="green" />
  <text font-size="16" y="8" fill="black" font-family="Menlo" dominant-baseline="middle" xml:space="preserve" x="40" text-anchor="start">parent       thread1    thread2</text>
  <text fill="black" y="40" x="430" font-size="16" xml:space="preserve" font-family="Menlo" dominant-baseline="middle" text-anchor="start">r </text>
  <text font-family="Menlo" xml:space="preserve" text-anchor="start" x="30" y="56" dominant-baseline="middle" font-size="16" fill="black">(arc1) </text>
  <text font-size="16" text-anchor="start" dominant-baseline="middle" x="190" y="56" font-family="Menlo" xml:space="preserve" fill="black">arc1 </text>
  <text y="56" xml:space="preserve" font-family="Menlo" font-size="16" fill="black" x="470" text-anchor="start" dominant-baseline="middle">atomic(2) </text>
  <text font-size="16" xml:space="preserve" fill="black" y="104" text-anchor="start" x="30" font-family="Menlo" dominant-baseline="middle">(arc2) </text>
  <text x="310" xml:space="preserve" dominant-baseline="middle" font-family="Menlo" y="104" text-anchor="start" fill="black" font-size="16">arc2 </text>
  <text text-anchor="start" font-size="16" dominant-baseline="middle" y="104" x="610" fill="black" xml:space="preserve" font-family="Menlo">"Hello"</text>
  <text text-anchor="start" xml:space="preserve" font-family="Menlo" x="610" y="136" fill="black" dominant-baseline="middle" font-size="16">" "</text>
  <text y="168" xml:space="preserve" font-size="16" x="610" text-anchor="start" dominant-baseline="middle" font-family="Menlo" fill="black">"World!"</text>
  <text fill="black" y="216" font-size="16" dominant-baseline="middle" x="50" xml:space="preserve" font-family="Menlo" text-anchor="start">. . .          </text>
</svg>
</section><section id="more-general-idea" class="slide level2 left_align">
<h2>More general idea</h2>
<ul>
<li><p><code>Rc&lt;T&gt;</code> vs <code>Arc&lt;T&gt;</code> is (an important) detail</p></li>
<li><p>Fundamental <em>concept</em> is deeper</p></li>
<li><p>Traits <code>Send</code> and <code>Sync</code> control cross-thread capabilities</p></li>
</ul>
<ul>
<li class="fragment"><code>T: Send</code> implies ownership of <code>T</code> can be tranferred across threads</li>
</ul>
<ul>
<li class="fragment"><code>T: Sync</code> implies a reference to <code>T</code> (e.g. <code>&amp;T</code>, <code>Arc&lt;T&gt;</code>) can be shared across threads</li>
</ul>
<ul>
<li class="fragment"><code>Send</code> enables Message Passing style concurrency, via channels</li>
</ul>
<ul>
<li class="fragment"><code>Sync</code> enables Shared State style concurrency; only <code>T</code> with synchronized access is allowed</li>
</ul>
</section><section id="any-other-solutions-to-this-besides-shared-ownership" class="slide level2 center">
<h2>Any other solutions to this besides shared ownership?</h2>
<div class="fragment">
<p>Yes; the best ones are in crates outside Rust stdlib.</p>
</div>
</section><section id="crossbeam" class="slide level2 big_text center">
<h2>crossbeam</h2>
<ul>
<li><p>provides lock-free data structures</p></li>
<li><p>and a scoped threading abstraction</p></li>
<li><p>upholds Rust's safety (data-race freedom) guarantees</p></li>
</ul>
</section><section id="scoped-threading" class="slide level2">
<h2>scoped threading?</h2>
<p><code>std::thead</code> does not allow sharing stack-local data</p>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">fn</span> std_thread_fail() <span class="op">{</span>
    <span class="kw">let</span> array: <span class="op">[</span><span class="dt">String</span>; <span class="dv">3</span><span class="op">]</span> = <span class="op">[</span><span class="pp">format!</span>(<span class="st">&quot;hello&quot;</span>), <span class="pp">format!</span>(<span class="st">&quot; &quot;</span>), <span class="pp">format!</span>(<span class="st">&quot;world&quot;</span>)<span class="op">]</span>;

    <span class="kw">for</span> string_ref <span class="kw">in</span> &amp;array <span class="op">{</span>
        std::thread::spawn(<span class="kw">move</span> || <span class="op">{</span>
            <span class="kw">let</span> r: &amp;<span class="dt">String</span> = string_ref;
            <span class="pp">println!</span>(<span class="st">&quot;element: {}&quot;</span>, r);
        <span class="op">}</span>);
    <span class="op">}</span>
 <span class="op">}</span> <span class="co">// end of `array` scope; it is popped and strings are deallocated</span></code></pre></div>
<div class="fragment">
<pre><code>error: `array` does not live long enough
  --&gt; src/b01_concurrency_demos.rs:92:24
   |
92 |     for string_ref in &amp;array {
   |                        ^^^^^ does not live long enough
...
98 |  } // end of `array` scope; it is popped and strings are deallocated
   |  - borrowed value only lives until here
   |
   = note: borrowed value must be valid for the static lifetime...</code></pre>
</div>
</section><section id="crossbeam-scoped-threading" class="slide level2">
<h2><code>crossbeam</code> scoped threading</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> crossbeam_demo() <span class="op">{</span>
    <span class="kw">let</span> array: <span class="op">[</span><span class="dt">String</span>; <span class="dv">3</span><span class="op">]</span> = <span class="op">[</span><span class="pp">format!</span>(<span class="st">&quot;hello&quot;</span>), <span class="pp">format!</span>(<span class="st">&quot; &quot;</span>), <span class="pp">format!</span>(<span class="st">&quot;world&quot;</span>)<span class="op">]</span>;

    ::crossbeam::scope(|scope| <span class="op">{</span>
        <span class="kw">for</span> string_ref <span class="kw">in</span> &amp;array <span class="op">{</span>
            <span class="kw">let</span> r: &amp;<span class="dt">String</span> = string_ref;
            scope.spawn(<span class="kw">move</span> || <span class="op">{</span>
                <span class="pp">println!</span>(<span class="st">&quot;element: {}&quot;</span>, r);
            <span class="op">}</span>);
        <span class="op">}</span>
    <span class="op">}</span>);
<span class="op">}</span></code></pre></div>
<div class="fragment">
<svg xmlns="http://www.w3.org/2000/svg" baseProfile="full" viewBox="0 0 400 176" version="1.1" height="176" width="400">
  <path stroke-width="2" fill="none" stroke-dasharray="5,2" d="M 75,40 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 90,40L 100,40L 110,40L 120,40L 130,40L 140,40L 150,40L 160,40L 170,40L 180,40L 190,40L 200,40L 210,40L 220,40L 230,40L 240,40L 250,40L 260,40L 270,40L 280,40L 290,40L 300,40L 310,40L 320,40L 330,40L 340,40" stroke="green" />
  <path fill="none" id="t1" stroke-width="2" stroke="blue" d="M 355,32 L 355,48L 355,64L 355,80L 355,96L 355,112L 355,128L 355,131 A 2,2 0 1 0 355,141  A 2,2 0 0 0 355,131 A 2,2 0 1 0 355,141" />
  <path stroke="green" d="M 75,56 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 90,56L 100,56L 110,56L 120,56L 130,56L 140,56L 150,56L 160,56L 170,56L 180,56L 190,56L 200,56L 210,56L 220,56L 230,56L 240,56" stroke-dasharray="5,2" stroke-width="2" fill="none" />
  <path stroke-width="2" fill="none" stroke="blue" d="M 255,48 L 255,64L 255,80L 255,96L 255,112L 255,115 A 2,2 0 1 0 255,125  A 2,2 0 0 0 255,115 A 2,2 0 1 0 255,125" id="t2" />
  <path stroke="green" d="M 75,72 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 90,72L 100,72L 110,72L 120,72" fill="none" stroke-width="2" stroke-dasharray="5,2" />
  <path stroke-width="2" id="t3" fill="none" d="M 135,64 L 135,80L 135,96L 135,99 A 2,2 0 1 0 135,109  A 2,2 0 0 0 135,99 A 2,2 0 1 0 135,109" stroke="blue" />
  <path stroke-width="2" d="M 35,80 L 35,96L 35,112L 35,128L 35,144L 35,160L 35,176" stroke="blue" id="p" fill="none" />
  <path d="M 55,104 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 70,104L 80,104L 90,104L 100,104L 110,104L 120,104" stroke="green" fill="none" stroke-width="2" />
  <path fill="none" stroke="green" stroke-width="2" d="M 55,120 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 70,120L 80,120L 90,120L 100,120L 110,120L 120,120L 130,120L 140,120L 150,120L 160,120L 170,120L 180,120L 190,120L 200,120L 210,120L 220,120L 230,120L 240,120" />
  <path fill="none" stroke="green" d="M 55,136 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 70,136L 80,136L 90,136L 100,136L 110,136L 120,136L 130,136L 140,136L 150,136L 160,136L 170,136L 180,136L 190,136L 200,136L 210,136L 220,136L 230,136L 240,136L 250,136L 260,136L 270,136L 280,136L 290,136L 300,136L 310,136L 320,136L 330,136L 340,136" stroke-width="2" />
  <text text-anchor="start" dominant-baseline="middle" x="0" fill="black" xml:space="preserve" y="8" font-size="16" font-family="Menlo">parent    thread3    thread2    thread1</text>
  <text x="10" xml:space="preserve" dominant-baseline="middle" text-anchor="start" fill="black" font-family="Menlo" y="40" font-size="16">[str1,</text>
  <text text-anchor="start" y="56" dominant-baseline="middle" xml:space="preserve" x="20" font-size="16" fill="black" font-family="Menlo">str2,</text>
  <text x="20" xml:space="preserve" text-anchor="start" y="72" fill="black" dominant-baseline="middle" font-size="16" font-family="Menlo">str3]</text>
</svg>
<p><code>::crossbeam::scope</code> enforces parent thread joins on all spawned children before returning</p>
<ul>
<li>ensures child threads can soundly access local refs they receive</li>
</ul>
</div>
</section><section id="crossbeam-scope-must-be-concurrency" class="slide level2 big_text center">
<h2>crossbeam <code>scope</code>: &quot;must-be concurrency&quot;</h2>
<p>Each <code>scope.spawn(..)</code> invocation fires up a fresh thread</p>
<p>(Literally just a wrapper around <code>std::thread</code>)</p>
</section><section id="crossbeam-scope-must-be-concurrency-1" class="slide level2 big_text center">
<h2>crossbeam <code>scope</code>: &quot;must-be concurrency&quot;</h2>
<h3 id="vs-rayon-may-be-parallelism" class="fragment big_text center">vs <code>rayon</code>: &quot;may-be parallelism&quot;</h3>
</section><section id="rayon-demo-1-map-reduce" class="slide level2">
<h2><code>rayon</code> demo 1: map reduce</h2>
<!--
```rust
struct Store;
struct Item;
type Groceries<'a> = &'a [Item];
use rayon;
use rayon::prelude::*;
impl Store {
    fn compute_price(&self, g: Groceries) -> u32 { unimplemented!() }
}
```
-->
<h3 id="sequential">Sequential</h3>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> demo_map_reduce_seq(stores: &amp;<span class="op">[</span>Store<span class="op">]</span>, list: Groceries) -&gt; <span class="dt">u32</span> <span class="op">{</span>
    <span class="kw">let</span> total_price = stores.iter()
                            .map(|store| store.compute_price(&amp;list))
                            .sum();
    <span class="kw">return</span> total_price;
<span class="op">}</span></code></pre></div>
<h3 id="parallel-potentially">Parallel (<em>potentially</em>)</h3>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> demo_map_reduce_par(stores: &amp;<span class="op">[</span>Store<span class="op">]</span>, list: Groceries) -&gt; <span class="dt">u32</span> <span class="op">{</span>
    <span class="kw">let</span> total_price = stores.par_iter()
                            .map(|store| store.compute_price(&amp;list))
                            .sum();
    <span class="kw">return</span> total_price;
<span class="op">}</span></code></pre></div>
</section><section id="rayons-rule" class="slide level2">
<h2>Rayon's Rule</h2>
<blockquote>
<p>the decision of whether or not to use parallel threads is made dynamically, based on whether idle cores are available</p>
</blockquote>
<div class="fragment">
<p>i.e., solely for offloading work, <em>not</em> for when concurrent operation is necessary for correctness</p>
</div>
<div class="fragment">
<p>(uses work-stealing under the hood to distribute work among a fixed set of threads)</p>
</div>
</section><section id="rayon-demo-2-quicksort" class="slide level2" data-transition="fade-out">
<h2><code>rayon</code> demo 2: quicksort</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> quick_sort&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) <span class="op">{</span>
    <span class="kw">if</span> v.len() &gt; <span class="dv">1</span> <span class="op">{</span>
        <span class="kw">let</span> mid = partition(v);
        <span class="kw">let</span> (lo, hi) = v.split_at_mut(mid);
        rayon::join(|| quick_sort(lo),
                    || quick_sort(hi));
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<!--
```rust
fn partition<T:PartialOrd+Send>(v: &mut [T]) -> usize {
    // see https://en.wikipedia.org/wiki/Quicksort#Lomuto_partition_scheme
    unimplemented!()
}
```
-->
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> partition&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) -&gt; <span class="dt">usize</span> <span class="op">{</span>
    <span class="co">// see https://en.wikipedia.org/wiki/</span>
    <span class="co">//     Quicksort#Lomuto_partition_scheme</span>
    ...
<span class="op">}</span></code></pre></div>
</section><section id="rayon-demo-2-quicksort-1" class="slide level2" data-transition="fade">
<h2><code>rayon</code> demo 2: quicksort</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> quick_sort&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) <span class="op">{</span>
    <span class="kw">if</span> v.len() &gt; <span class="dv">1</span> <span class="op">{</span>
        <span class="kw">let</span> mid = partition(v);
        <span class="kw">let</span> (lo, hi) = v.split_at_mut(mid);
        rayon::join(|| quick_sort(lo),
                    || quick_sort(hi));
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="470" baseProfile="full" viewBox="0 0 470 320" height="320">
  <path id="q1" fill="none" stroke-width="2" d="M 45,16 L 45,32L 45,48L 45,64L 45,80L 45,96" stroke="blue" />
  <path fill="none" stroke="blue" d="M 235,80 L 235,96L 235,112L 235,120L 235,144L 235,160L 235,176L 235,192L 235,208L 235,224L 235,240L 235,256L 235,259 A 2,2 0 1 0 235,269  A 2,2 0 0 0 235,259 A 2,2 0 1 0 235,269" id="rl1" stroke-width="2" />
  <path fill="none" stroke-width="2" stroke="blue" id="rh1" d="M 395,80 L 395,96L 395,112L 395,128L 395,144L 395,160L 395,176L 395,192L 395,208L 395,224L 395,240L 395,256L 395,272L 395,275 A 2,2 0 1 0 395,285  A 2,2 0 0 0 395,275 A 2,2 0 1 0 395,285" />
  <path fill="none" stroke="green" stroke-width="2" d="M 105,96 L 105,112L 105,128Q 105,136 110,136Q 110,136 120,136L 130,136L 140,136L 150,136L 160,136L 170,136L 180,136L 190,136L 200,136L 210,136L 220,136" stroke-dasharray="5,2" />
  <path stroke-dasharray="5,2" stroke-width="2" stroke="green" d="M 175,96 L 175,112Q 175,120 180,120Q 180,120 190,120L 200,120L 210,120L 220,120L 230,120L 235,120L 250,120L 260,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120" fill="none" />
  <path stroke-width="2" id="q2" d="M 45,256 L 45,272L 45,288L 45,304L 45,320" stroke="blue" fill="none" />
  <path stroke-width="2" fill="none" stroke="green" d="M 65,264 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 80,264L 90,264L 100,264L 110,264L 120,264L 130,264L 140,264L 150,264L 160,264L 170,264L 180,264L 190,264L 200,264L 210,264L 220,264" />
  <path d="M 65,280 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 80,280L 90,280L 100,280L 110,280L 120,280L 130,280L 140,280L 150,280L 160,280L 170,280L 180,280L 190,280L 200,280L 210,280L 220,280L 230,280L 240,280L 250,280L 260,280L 270,280L 280,280L 290,280L 300,280L 310,280L 320,280L 330,280L 340,280L 350,280L 360,280L 370,280L 380,280" fill="none" stroke="green" stroke-width="2" />
  <text xml:space="preserve" text-anchor="start" font-family="Menlo" x="0" y="8" fill="black" font-size="16" dominant-baseline="middle">quick_sort            recur_lo         recur_hi</text>
  <text fill="black" text-anchor="start" font-size="16" font-family="Menlo" y="56" xml:space="preserve" x="60" dominant-baseline="middle">[0mid, mid]</text>
  <text x="70" font-family="Menlo" stroke="green" y="88" dominant-baseline="middle" text-anchor="start" font-size="16" fill="black" xml:space="preserve" id="s">      </text>
</svg>
</section><section id="rayon-demo-2-quicksort-2" class="slide level2" data-transition="fade">
<h2><code>rayon</code> demo 2: quicksort</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> quick_sort&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) <span class="op">{</span>
    <span class="kw">if</span> v.len() &gt; <span class="dv">1</span> <span class="op">{</span>
        <span class="kw">let</span> mid = partition(v);
        <span class="kw">let</span> (lo, hi) = v.split_at_mut(mid);
        rayon::join(|| quick_sort(lo),
                    || quick_sort(hi));
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<svg baseProfile="full" version="1.1" xmlns="http://www.w3.org/2000/svg" height="320" width="520" viewBox="0 0 520 320">
  <path stroke="blue" id="q1" d="M 45,16 L 45,32L 45,48L 45,64L 45,80L 45,96" stroke-width="2" fill="none" />
  <path stroke="blue" stroke-width="2" d="M 235,80 L 235,96L 235,112L 235,120L 235,144L 235,160" id="rl1" fill="none" />
  <path stroke-width="2" d="M 395,80 L 395,96L 395,112L 395,128L 395,144L 395,160" id="rh1" fill="none" stroke="blue" />
  <path stroke-dasharray="5,2" stroke-width="2" d="M 105,96 L 105,112L 105,128Q 105,136 110,136Q 110,136 120,136L 130,136L 140,136L 150,136L 160,136L 170,136L 180,136L 190,136L 200,136L 210,136L 220,136" fill="none" stroke="green" />
  <path stroke="green" fill="none" stroke-width="2" d="M 175,96 L 175,112Q 175,120 180,120Q 180,120 190,120L 200,120L 210,120L 220,120L 230,120L 235,120L 250,120L 260,120L 270,120L 280,120L 290,120L 300,120L 310,120L 320,120L 330,120L 340,120L 350,120L 360,120L 370,120L 380,120" stroke-dasharray="5,2" />
  <path d="M 275,144 L 275,160L 275,168L 275,192L 275,208L 275,211 A 2,2 0 1 0 275,221  A 2,2 0 0 0 275,211 A 2,2 0 1 0 275,221" stroke-width="2" stroke="blue" id="w" fill="none" />
  <path stroke="blue" stroke-width="2" id="x" d="M 325,144 L 325,160L 325,176L 325,192L 325,208L 325,211 A 2,2 0 1 0 325,221  A 2,2 0 0 0 325,211 A 2,2 0 1 0 325,221" fill="none" />
  <path d="M 435,144 L 435,160L 435,168L 435,192L 435,208L 435,211 A 2,2 0 1 0 435,221  A 2,2 0 0 0 435,211 A 2,2 0 1 0 435,221" id="y" stroke-width="2" stroke="blue" fill="none" />
  <path stroke-width="2" d="M 485,144 L 485,160L 485,176L 485,192L 485,208L 485,211 A 2,2 0 1 0 485,221  A 2,2 0 0 0 485,211 A 2,2 0 1 0 485,221" fill="none" id="z" stroke="blue" />
  <path stroke-width="2" d="M 240,168 L 250,168L 260,168L 270,168L 275,168L 290,168L 300,168L 310,168" stroke-dasharray="5,2" stroke="green" fill="none" />
  <path fill="none" stroke-width="2" stroke="green" d="M 400,168 L 410,168L 420,168L 430,168L 435,168L 450,168L 460,168L 470,168" stroke-dasharray="5,2" />
  <path d="M 240,184 L 250,184L 260,184" fill="none" stroke-width="2" stroke="green" stroke-dasharray="5,2" />
  <path fill="none" d="M 400,184 L 410,184L 420,184" stroke-dasharray="5,2" stroke-width="2" stroke="green" />
  <path d="M 235,224 L 235,240L 235,256L 235,259 A 2,2 0 1 0 235,269  A 2,2 0 0 0 235,259 A 2,2 0 1 0 235,269" stroke-width="2" fill="none" id="rl2" stroke="blue" />
  <path stroke-width="2" d="M 395,224 L 395,240L 395,256L 395,272L 395,275 A 2,2 0 1 0 395,285  A 2,2 0 0 0 395,275 A 2,2 0 1 0 395,285" stroke="blue" fill="none" id="rh2" />
  <path d="M 45,256 L 45,272L 45,288L 45,304L 45,320" fill="none" stroke-width="2" stroke="blue" id="q2" />
  <path stroke="green" d="M 65,264 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 80,264L 90,264L 100,264L 110,264L 120,264L 130,264L 140,264L 150,264L 160,264L 170,264L 180,264L 190,264L 200,264L 210,264L 220,264" fill="none" stroke-width="2" />
  <path stroke-width="2" fill="none" stroke="green" d="M 65,280 l -3,0 m 3,-3 l -3,3 l 3,3 m 0,-3L 80,280L 90,280L 100,280L 110,280L 120,280L 130,280L 140,280L 150,280L 160,280L 170,280L 180,280L 190,280L 200,280L 210,280L 220,280L 230,280L 240,280L 250,280L 260,280L 270,280L 280,280L 290,280L 300,280L 310,280L 320,280L 330,280L 340,280L 350,280L 360,280L 370,280L 380,280" />
  <text font-size="16" font-family="Menlo" text-anchor="start" x="0" fill="black" dominant-baseline="middle" y="8" xml:space="preserve">quick_sort            recur_lo         recur_hi</text>
  <text fill="black" y="56" font-family="Menlo" dominant-baseline="middle" font-size="16" xml:space="preserve" x="60" text-anchor="start">[0mid, mid]</text>
  <text xml:space="preserve" stroke="green" x="70" dominant-baseline="middle" text-anchor="start" id="s" font-family="Menlo" fill="black" font-size="16" y="88">      </text>
</svg>
<div class="fragment">
<p>&quot;Recursion is simple&quot;, right (?)</p>
</div>
</section><section id="rayon-demo-3-buggy-quicksort" class="slide level2" data-transition="fade-in">
<h2><code>rayon</code> demo 3: buggy quicksort</h2>
<div class="sourceCode"><pre class="sourceCode rust"><code class="sourceCode rust"><span class="kw">fn</span> quick_sort&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) <span class="op">{</span>
    <span class="kw">if</span> v.len() &gt; <span class="dv">1</span> <span class="op">{</span>
        <span class="kw">let</span> mid = partition(v);
        <span class="kw">let</span> (lo, hi) = v.split_at_mut(mid);
        rayon::join(|| quick_sort(lo),
                    || quick_sort(hi));
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode rust compile_error"><code class="sourceCode rust"><span class="kw">fn</span> quick_sort&lt;T:<span class="bu">PartialOrd</span>+<span class="bu">Send</span>&gt;(v: &amp;<span class="kw">mut</span> <span class="op">[</span>T<span class="op">]</span>) <span class="op">{</span>
    <span class="kw">if</span> v.len() &gt; <span class="dv">1</span> <span class="op">{</span>
        <span class="kw">let</span> mid = partition(v);
        <span class="kw">let</span> (lo, hi) = v.split_at_mut(mid);
        rayon::join(|| quick_sort(lo),
                    || quick_sort(lo));
        <span class="co">//                        ~~ data race!</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>(See blog post &quot;Rayon: Data Parallelism in Rust&quot; <code>bit.ly/1IZcku4</code>)</p>
</section><section id="big-idea" class="slide level2 big_text center">
<h2>Big Idea</h2>
<p>3rd parties identify (and provide) <em>new abstractions</em> for concurrency and parallelism unanticipated in std lib.</p>
</section></section>
<section><section id="sharing-code-cargo" class="titleslide slide level1 center"><h1>Sharing Code: Cargo</h1></section><section id="sharing-code" class="slide level2">
<h2>Sharing Code</h2>
<p><code>std::thread</code> is provided with std lib</p>
<div class="fragment">
<p>But <code>crossbeam</code> and <code>rayon</code> are 3rd party</p>
</div>
<div class="fragment">
<p>What is Rust's code distribution story?</p>
</div>
</section><section id="cargo" class="slide level2">
<h2>Cargo</h2>
<p><code>cargo</code> is really simple to use</p>
<div class="fragment">
<pre><code>cargo new     -- create a project
cargo test    -- run project&#39;s unit tests
cargo run     -- run binaries associated with project
cargo publish -- push project up to crates.io</code></pre>
</div>
<div class="fragment">
<p>Edit the associated <code>Cargo.toml</code> file to:</p>
<ul>
<li>add dependencies</li>
<li>specify version / licensing info</li>
<li>conditionally compiled features</li>
<li>add build-time behaviors (e.g. code generation)</li>
</ul>
</div>
<div class="fragment">
<p>&quot;What's this about publishing to <code>crates.io</code>?&quot;</p>
</div>
</section><section id="crates.io" class="slide level2">
<h2>crates.io</h2>
<p>Open-source crate distribution site</p>
<p>Has every version of every crate</p>
<p>Cargo adheres to <em>semantic versioning</em> (&quot;semver&quot;)</p>
</section><section id="semver" class="slide level2">
<h2>Semver</h2>
<!--
From the cargo docs

> Cargo bakes in the concept of [Semantic Versioning][], so make sure you follow some basic rules:
>
> * Before you reach 1.0.0, anything goes.
> * After 1.0.0, only make breaking changes when you increment the major version. In Rust, breaking changes include adding fields to structs or variants to enums. Dont break the build.
> * After 1.0.0, dont add any new public API (no new pub anything) in tiny versions. Always increment the minor version if you add any new pub structs, traits, fields, types, functions, methods or anything else.
> * Use version numbers with three numeric parts such as 1.0.0 rather than 1.0.
-->
<p>The use of <a href="http://semver.org/">Semantic Versioning</a> in <code>cargo</code> basically amounts to this:</p>
<p>Major versions (MAJOR.minor.patch) are free to break whatever they want.</p>
<p>New public API's can be added with minor versions updates (major.MINOR.patch), as long as they do not impose breaking changes.</p>
<div class="fragment">
<p>In Rust, breaking changes <em>includes</em> data-structure representation changes.</p>
<p>Adding fields to structs (or variants to enums) can cause their memory representation to change.</p>
</div>
</section><section id="why-major-versions-can-include-breaking-changes" class="slide level2">
<h2>Why major versions can include breaking changes</h2>
<p>Cargo invokes the Rust compiler in a way that salts the symbols exported by a compiled library.</p>
<p>This ends up allowing two distinct (major) versions of a library to be used <em>simultaneously</em> in the same program.</p>
<p>This is important when pulling in third party libraries.</p>
<!--
## Fixing versions

`cargo` generates a `Cargo.lock` file that tracks the versions you built the project with

Intent: application (i.e. final) crates should check their `Cargo.lock` into version control

 * Ensures that future build attempts will choose the *same* versions

However: library (i.e. intermediate) crates should *not* check their `Cargo.lock` into version control.

 * Instead, everyone should follow sem.ver.; then individual applications can mix different libraries
   into their final product, upgrading intermediate libraries as necessary

-->
</section><section id="in-practice" class="slide level2">
<h2>In Practice</h2>
<ul>
<li><p>If you (*) follow the sem.ver. rules, then you do not usually have to think hard about the crates you (recursively) import.</p></li>
<li><p>&quot;you&quot; is really &quot;you and all the crates you use&quot;</p></li>
</ul>
<p></p>
<ul>
<li class="fragment">You may not believe me, but <code>cargo</code> is really simple to use</li>
<li class="fragment">Coming from a C/C++ world, this feels like magic</li>
<li class="fragment">(probably feels like old hat for people used to package dependency managers)</li>
</ul>
</section></section>
<section><section id="final-words" class="titleslide slide level1"><h1>Final Words</h1></section><section id="so-much-more" class="slide level2">
<h2>So much more!</h2>
<p>Touched on things like <code>Send</code> and <code>Sync</code>, but there is more to Rust's secret sauce</p>
<ul>
<li class="fragment">Lifetimes</li>
</ul>
<ul>
<li class="fragment">Object-orientation via trait-references</li>
</ul>
<ul>
<li class="fragment">Unboxed closures</li>
</ul>
<div class="fragment">
<p>Lots of technology (and still evolving!)</p>
</div>
</section><section id="customers" class="slide level2 big_text left_align">
<h2>Customers</h2>
<p>See <a href="https://www.rust-lang.org/en-US/friends.html" class="uri">https://www.rust-lang.org/en-US/friends.html</a></p>
<ul>
<li><p>Mozilla (of course)</p></li>
<li><p>Dropbox (see &quot;Wired&quot; article on exodus from Amazon cloud)</p></li>
<li><p>MaidSafe</p></li>
</ul>
</section><section id="pivot-from-cc-to-rust" class="slide level2 big_text center">
<h2>Pivot from C/C++ to Rust</h2>
<p>MaidSafe is one example of this</p>
<p><a href="https://blog.maidsafe.net/2015/07/01/the-ants-are-coming/" class="uri">https://blog.maidsafe.net/2015/07/01/the-ants-are-coming/</a></p>
</section><section id="rust-as-enabler-of-individuals" class="slide level2 big_text center">
<h2>Rust as enabler of individuals</h2>
<h3 id="from-mere-script-programmer">From &quot;mere script programmer&quot;</h3>
<h3 id="to-lauded-systems-hacker">to &quot;lauded systems hacker&quot;</h3>
<div class="fragment">
<blockquote>
<p>Programming in Rust has made me look at C++ code in a whole new light</p>
</blockquote>
<aside class="notes">
I believe experience with Rust will make you a better C++ programmer
</aside>
<!--

## Or if you prefer: {.big_text .center}

Enabling *sharing* systems hacking knowledge with everyone

. . .

> After experiencing Rust, I dread looking at code from prior projects ... I will now see how riddled with races it was

. . .

> Programming in Rust has made me look at C++ code in a whole new light

-->
</div>
</section><section id="thanks" class="slide level2">
<h2>Thanks</h2>
<div class="no_border logo">
<img src="Rust_programming_language_black_logo.svg" />
<div>

<table>
<tbody>
<tr class="odd">
<td><code>www.rust-lang.org</code></td>
<td>Hack Without Fear</td>
</tr>
</tbody>
</table>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Vertical centering of slides
        center: false,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
              { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
